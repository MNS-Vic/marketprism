# 📁 MarketPrism配置文件整理方案

## 🎯 整理目标

基于配置文件审计结果（134个配置文件），制定系统性整理方案：
- **总文件数**: 134个
- **按功能分布**: 监控27个、核心58个、数据库21个、服务12个、交易所10个等
- **主要问题**: 129个可能未使用的文件，配置分散，命名不统一

## 📊 当前问题分析

### **问题1: 配置文件过多且分散**
- 134个配置文件分布在多个子目录
- 核心配置(58个)和监控配置(27个)文件过多
- 缺乏清晰的组织结构

### **问题2: 可能存在过时配置**
- 129个文件可能未被使用
- 包含测试配置、开发配置混杂在生产配置中
- 版本控制和历史配置未清理

### **问题3: 命名和格式不统一**
- 同时使用.yaml和.yml扩展名
- 文件命名规范不一致（下划线vs连字符）
- 配置结构和格式不统一

## 🗂️ 新的目录结构设计

```
config/
├── 📁 core/                          # 核心配置（保留必要的）
│   ├── app_config.yaml               # 应用主配置
│   ├── environment_overrides.yaml    # 环境覆盖配置
│   └── unified_config_loader.py      # 配置加载器
├── 📁 monitoring/                     # 监控配置（高优先级整合）
│   ├── prometheus/
│   │   ├── prometheus.yml            # Prometheus主配置
│   │   ├── rules.yml                 # 告警规则
│   │   └── performance_baselines.yml # 性能基线
│   ├── alerting/
│   │   ├── alert_manager.yml         # AlertManager配置
│   │   └── noise_reduction.yml       # 告警降噪配置
│   ├── grafana/
│   │   ├── dashboard_config.yml      # 仪表板配置
│   │   └── dashboards/               # 仪表板文件
│   └── logging/
│       └── promtail.yml              # 日志收集配置
├── 📁 exchanges/                      # 交易所配置（中优先级）
│   ├── exchanges.yml                 # 主交易所配置
│   ├── binance.yml                   # Binance配置
│   ├── okx.yml                       # OKX配置
│   └── deribit.yml                   # Deribit配置
├── 📁 infrastructure/                 # 基础设施配置
│   ├── database/
│   │   ├── clickhouse.xml            # ClickHouse配置
│   │   └── schemas/                  # 数据库表结构
│   ├── messaging/
│   │   ├── nats.conf                 # NATS配置
│   │   └── streams.yml               # 流配置
│   └── proxy/
│       └── proxy.yml                 # 代理配置
├── 📁 services/                       # 服务配置
│   ├── services.yml                  # 服务注册配置
│   ├── data_collector.yml            # 数据收集器配置
│   ├── api_gateway.yml               # API网关配置
│   └── storage.yml                   # 存储服务配置
├── 📁 environments/                   # 环境配置
│   ├── production.yml                # 生产环境
│   ├── staging.yml                   # 测试环境
│   └── development.yml               # 开发环境
└── 📁 archive/                        # 归档配置（过时/未使用）
    ├── deprecated/                   # 已废弃配置
    ├── legacy/                       # 遗留配置
    └── backup/                       # 备份配置
```

## 🔄 整理执行计划

### **阶段1: 高优先级 - 监控配置整合**
1. **整合monitoring目录**
   - 合并prometheus相关配置
   - 统一告警配置文件
   - 整理grafana仪表板
   - 标准化文件命名

2. **清理重复配置**
   - 删除过时的监控配置
   - 合并功能相似的配置文件
   - 统一配置格式

### **阶段2: 中优先级 - 交易所和基础设施配置**
1. **整合exchanges目录**
   - 合并分散的交易所配置
   - 统一配置结构
   - 删除重复的交易所配置

2. **整理infrastructure配置**
   - 分类数据库、消息队列、代理配置
   - 合并ClickHouse相关配置
   - 整理NATS配置

### **阶段3: 低优先级 - 其他配置整理**
1. **整理services配置**
   - 合并服务相关配置
   - 统一服务配置格式

2. **环境配置分离**
   - 分离开发、测试、生产配置
   - 建立环境配置继承关系

3. **归档过时配置**
   - 移动未使用配置到archive
   - 保留重要的历史配置

## 📝 配置标准化规范

### **文件命名规范**
- 使用连字符分隔: `alert-manager.yml`
- 统一使用`.yml`扩展名（YAML文件）
- 配置文件名应简洁明确
- 避免使用下划线和复杂命名

### **目录命名规范**
- 使用小写字母和连字符
- 目录名应反映功能模块
- 避免过深的目录嵌套（最多3层）

### **配置文件结构规范**
```yaml
# 文件头注释
# MarketPrism [模块名] 配置
# 描述: 配置文件用途说明
# 更新: YYYY-MM-DD

# 全局配置
global:
  # 全局设置

# 主要配置段
main_section:
  # 主要配置内容

# 可选配置段
optional_section:
  # 可选配置内容
```

## 🔍 依赖关系处理

### **配置文件引用更新**
1. **更新docker-compose.yml中的路径引用**
2. **更新服务启动脚本中的配置路径**
3. **更新文档中的配置文件引用**
4. **更新代码中的配置文件加载路径**

### **验证依赖关系**
1. **检查所有配置文件引用**
2. **验证服务启动正常**
3. **确保监控系统正常工作**
4. **测试配置热重载功能**

## ✅ 验证和测试计划

### **功能验证**
1. **服务启动验证**
   - 验证所有服务能正常启动
   - 检查配置文件加载无错误
   - 确认服务间通信正常

2. **监控系统验证**
   - 验证Prometheus配置正确
   - 检查Grafana仪表板正常
   - 确认告警规则生效

3. **数据流验证**
   - 验证数据收集正常
   - 检查数据存储正常
   - 确认数据处理流程无误

### **回滚方案**
1. **配置备份**
   - 整理前完整备份config目录
   - 记录所有文件移动操作
   - 保留原始配置文件引用

2. **快速回滚**
   - 准备回滚脚本
   - 建立配置文件映射表
   - 确保能快速恢复原始状态

## 📋 执行检查清单

### **整理前检查**
- [ ] 完成配置文件审计
- [ ] 备份当前config目录
- [ ] 记录当前服务运行状态
- [ ] 准备回滚方案

### **整理过程检查**
- [ ] 按阶段执行整理
- [ ] 更新配置文件引用
- [ ] 验证每个阶段的功能
- [ ] 记录所有变更操作

### **整理后验证**
- [ ] 验证所有服务正常启动
- [ ] 检查监控系统正常工作
- [ ] 确认数据流处理正常
- [ ] 更新相关文档

## 🎯 预期效果

### **组织结构改善**
- 配置文件数量减少30-40%
- 目录结构清晰，易于维护
- 配置文件命名统一规范

### **维护效率提升**
- 配置查找时间减少50%
- 配置修改错误率降低
- 新人上手难度降低

### **系统稳定性**
- 减少配置冲突和错误
- 提高配置管理可靠性
- 便于配置版本控制

## 📅 执行时间表

- **阶段1 (监控配置)**: 2小时
- **阶段2 (交易所/基础设施)**: 1.5小时  
- **阶段3 (其他配置)**: 1小时
- **验证和测试**: 1小时
- **文档更新**: 0.5小时

**总计**: 约6小时完成整个配置文件整理工作
