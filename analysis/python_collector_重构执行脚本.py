#!/usr/bin/env python3\n\"\"\"\nPython Collector é‡æ„æ‰§è¡Œè„šæœ¬\n\né‡æ„ç›®æ ‡ï¼š\n1. æå‡ä¼˜è´¨ç»„ä»¶åˆ°é¡¹ç›®çº§åˆ«core/\n2. ç§»é™¤é‡å¤çš„åŸºç¡€è®¾æ–½ç»„ä»¶\n3. ç®€åŒ–collectorèŒè´£ï¼Œä¸“æ³¨æ•°æ®æ”¶é›†\n4. æ•´åˆæ¶æ„ï¼Œä½¿ç”¨ç»Ÿä¸€çš„coreæœåŠ¡\n\"\"\"\n\nimport os\nimport shutil\nimport logging\nfrom pathlib import Path\nfrom typing import Dict, List, Any\nimport time\nfrom datetime import datetime\n\n# é…ç½®æ—¥å¿—\nlogging.basicConfig(\n    level=logging.INFO,\n    format='%(asctime)s - %(levelname)s - %(message)s',\n    handlers=[\n        logging.FileHandler(f'python_collector_é‡æ„_{int(time.time())}.log'),\n        logging.StreamHandler()\n    ]\n)\nlogger = logging.getLogger(__name__)\n\n\nclass PythonCollectorRefactor:\n    \"\"\"Python Collectoré‡æ„å™¨\"\"\"\n    \n    def __init__(self, project_root: str):\n        self.project_root = Path(project_root)\n        self.collector_dir = self.project_root / \"services\" / \"python-collector\" / \"src\" / \"marketprism_collector\"\n        self.core_dir = self.project_root / \"core\"\n        self.backup_dir = self.project_root / \"backup\" / f\"collector_refactor_{int(time.time())}\"\n        \n        # ç¡®ä¿ç›®å½•å­˜åœ¨\n        self.backup_dir.mkdir(parents=True, exist_ok=True)\n        \n    def analyze_quality_components(self) -> Dict[str, List[str]]:\n        \"\"\"åˆ†æå¯æå‡åˆ°é¡¹ç›®çº§åˆ«çš„ä¼˜è´¨ç»„ä»¶\"\"\"\n        \n        quality_components = {\n            \"excellent\": [  # ä¼˜ç§€ç»„ä»¶ï¼Œç›´æ¥æå‡\n                \"core/tracing/trace_context.py\",\n                \"core/errors/unified_error_handler.py\", \n                \"core/middleware/middleware_framework.py\",\n                \"core/logging/structured_logger.py\",\n                \"core/caching/cache_coordinator.py\"\n            ],\n            \"good\": [  # è‰¯å¥½ç»„ä»¶ï¼Œå¯è€ƒè™‘æå‡\n                \"core/errors/error_categories.py\",\n                \"core/errors/error_context.py\",\n                \"core/errors/recovery_manager.py\",\n                \"core/logging/log_formatters.py\",\n                \"core/caching/cache_interface.py\",\n                \"core/service_discovery/service_discovery.py\"\n            ],\n            \"duplicate\": [  # é‡å¤ç»„ä»¶ï¼Œç§»é™¤\n                \"core/monitoring/\",\n                \"core/security/\", \n                \"core/performance/\",\n                \"storage/\",\n                \"reliability/\"\n            ],\n            \"remove\": [  # éæ ¸å¿ƒç»„ä»¶ï¼Œç§»é™¤\n                \"core/kubernetes_orchestration/\",\n                \"core/devops_infrastructure/\",\n                \"core/api_gateway/\",\n                \"core/gateway_ecosystem/\",\n                \"core/analytics/\"\n            ]\n        }\n        \n        return quality_components\n    \n    def backup_collector(self):\n        \"\"\"å¤‡ä»½åŸcollectorä»£ç \"\"\"\n        logger.info(\"ğŸ”„ å¤‡ä»½åŸcollectorä»£ç ...\")\n        \n        try:\n            if self.collector_dir.exists():\n                backup_collector_dir = self.backup_dir / \"original_collector\"\n                shutil.copytree(self.collector_dir, backup_collector_dir)\n                logger.info(f\"âœ… å¤‡ä»½å®Œæˆ: {backup_collector_dir}\")\n                return True\n        except Exception as e:\n            logger.error(f\"âŒ å¤‡ä»½å¤±è´¥: {e}\")\n            return False\n    \n    def promote_quality_components(self):\n        \"\"\"æå‡ä¼˜è´¨ç»„ä»¶åˆ°é¡¹ç›®çº§åˆ«\"\"\"\n        logger.info(\"ğŸš€ æå‡ä¼˜è´¨ç»„ä»¶åˆ°é¡¹ç›®çº§åˆ«...\")\n        \n        quality_components = self.analyze_quality_components()\n        promoted_count = 0\n        \n        for component_path in quality_components[\"excellent\"]:\n            source_path = self.collector_dir / component_path\n            \n            if source_path.exists():\n                # ç¡®å®šç›®æ ‡è·¯å¾„\n                target_path = self.core_dir / component_path.replace(\"core/\", \"\")\n                target_path.parent.mkdir(parents=True, exist_ok=True)\n                \n                try:\n                    # å¤åˆ¶åˆ°é¡¹ç›®çº§core\n                    shutil.copy2(source_path, target_path)\n                    logger.info(f\"âœ… æå‡ç»„ä»¶: {component_path} -> {target_path}\")\n                    promoted_count += 1\n                    \n                    # åˆ›å»ºå¢å¼ºç‰ˆæœ¬ï¼ˆæ·»åŠ é¡¹ç›®çº§é›†æˆï¼‰\n                    self._enhance_promoted_component(target_path)\n                    \n                except Exception as e:\n                    logger.error(f\"âŒ æå‡ç»„ä»¶å¤±è´¥ {component_path}: {e}\")\n        \n        logger.info(f\"ğŸ‰ æå‡å®Œæˆï¼Œå…±æå‡ {promoted_count} ä¸ªä¼˜è´¨ç»„ä»¶\")\n    \n    def _enhance_promoted_component(self, component_path: Path):\n        \"\"\"å¢å¼ºæå‡çš„ç»„ä»¶ï¼ˆæ·»åŠ é¡¹ç›®çº§é›†æˆï¼‰\"\"\"\n        try:\n            if component_path.name == \"trace_context.py\":\n                # å¢å¼ºè¿½è¸ªä¸Šä¸‹æ–‡ï¼Œæ·»åŠ MarketPrismé›†æˆ\n                content = component_path.read_text(encoding='utf-8')\n                \n                # æ·»åŠ MarketPrismç‰¹å®šçš„è¿½è¸ªåŠŸèƒ½\n                enhanced_content = content + '''\n\n# MarketPrismç‰¹å®šè¿½è¸ªå¢å¼º\nclass MarketPrismTraceContext(TraceContext):\n    \"\"\"MarketPrismç‰¹å®šçš„è¿½è¸ªä¸Šä¸‹æ–‡\"\"\"\n    \n    def set_exchange_context(self, exchange: str, symbol: str = None):\n        \"\"\"è®¾ç½®äº¤æ˜“æ‰€ä¸Šä¸‹æ–‡\"\"\"\n        self.set_tag(\"exchange\", exchange)\n        if symbol:\n            self.set_tag(\"symbol\", symbol)\n    \n    def set_market_data_context(self, data_type: str, count: int = None):\n        \"\"\"è®¾ç½®å¸‚åœºæ•°æ®ä¸Šä¸‹æ–‡\"\"\"\n        self.set_tag(\"market_data_type\", data_type)\n        if count is not None:\n            self.set_tag(\"data_count\", count)\n    \n    def set_trading_context(self, action: str, amount: float = None):\n        \"\"\"è®¾ç½®äº¤æ˜“ä¸Šä¸‹æ–‡\"\"\"\n        self.set_tag(\"trading_action\", action)\n        if amount is not None:\n            self.set_tag(\"trading_amount\", amount)\n\n\ndef create_marketprism_trace_context(operation_name: str, **kwargs) -> MarketPrismTraceContext:\n    \"\"\"åˆ›å»ºMarketPrismè¿½è¸ªä¸Šä¸‹æ–‡\"\"\"\n    current = get_current_trace_context()\n    \n    if current:\n        span_context = SpanContext.create_child(current.span_context)\n    else:\n        span_context = SpanContext.create_root()\n    \n    return MarketPrismTraceContext(\n        span_context=span_context,\n        operation_name=operation_name,\n        service_name=\"marketprism\",\n        **kwargs\n    )\n'''\n                \n                component_path.write_text(enhanced_content, encoding='utf-8')\n                logger.info(f\"ğŸ”§ å¢å¼ºç»„ä»¶: {component_path.name}\")\n                \n        except Exception as e:\n            logger.warning(f\"âš ï¸ å¢å¼ºç»„ä»¶å¤±è´¥ {component_path}: {e}\")\n    \n    def remove_duplicate_components(self):\n        \"\"\"ç§»é™¤é‡å¤çš„åŸºç¡€è®¾æ–½ç»„ä»¶\"\"\"\n        logger.info(\"ğŸ—‘ï¸ ç§»é™¤é‡å¤çš„åŸºç¡€è®¾æ–½ç»„ä»¶...\")\n        \n        quality_components = self.analyze_quality_components()\n        removed_count = 0\n        \n        # ç§»é™¤é‡å¤ç»„ä»¶\n        for component_path in quality_components[\"duplicate\"] + quality_components[\"remove\"]:\n            full_path = self.collector_dir / component_path\n            \n            if full_path.exists():\n                try:\n                    if full_path.is_dir():\n                        shutil.rmtree(full_path)\n                    else:\n                        full_path.unlink()\n                    \n                    logger.info(f\"ğŸ—‘ï¸ ç§»é™¤é‡å¤ç»„ä»¶: {component_path}\")\n                    removed_count += 1\n                    \n                except Exception as e:\n                    logger.error(f\"âŒ ç§»é™¤ç»„ä»¶å¤±è´¥ {component_path}: {e}\")\n        \n        logger.info(f\"ğŸ‰ æ¸…ç†å®Œæˆï¼Œå…±ç§»é™¤ {removed_count} ä¸ªé‡å¤ç»„ä»¶\")\n    \n    def create_core_integration(self):\n        \"\"\"åˆ›å»ºä¸é¡¹ç›®çº§coreçš„é›†æˆæ¥å£\"\"\"\n        logger.info(\"ğŸ”— åˆ›å»ºcoreé›†æˆæ¥å£...\")\n        \n        # åˆ›å»ºcoreé›†æˆæ¨¡å—\n        integration_code = '''\n\"\"\"\nMarketPrism Collector - Core é›†æˆæ¨¡å—\n\næä¾›ä¸é¡¹ç›®çº§coreæœåŠ¡çš„ç»Ÿä¸€é›†æˆæ¥å£\n\"\"\"\n\nimport logging\nfrom typing import Optional\n\n# å¯¼å…¥é¡¹ç›®çº§coreæœåŠ¡\ntry:\n    from core.monitoring import get_metrics_manager, MetricsManager\n    from core.security import get_security_manager, SecurityManager  \n    from core.reliability import get_reliability_manager, ReliabilityManager\n    from core.storage import get_storage_manager, StorageManager\n    from core.performance import get_performance_manager, PerformanceManager\nexcept ImportError as e:\n    logging.warning(f\"éƒ¨åˆ†coreæœåŠ¡å¯¼å…¥å¤±è´¥: {e}\")\n    \n    # æä¾›mockæ¥å£é˜²æ­¢å¯¼å…¥é”™è¯¯\n    def get_metrics_manager() -> Optional[object]:\n        return None\n    \n    def get_security_manager() -> Optional[object]:\n        return None\n    \n    def get_reliability_manager() -> Optional[object]:\n        return None\n    \n    def get_storage_manager() -> Optional[object]:\n        return None\n    \n    def get_performance_manager() -> Optional[object]:\n        return None\n\n\nclass CoreServiceIntegration:\n    \"\"\"æ ¸å¿ƒæœåŠ¡é›†æˆç®¡ç†å™¨\"\"\"\n    \n    def __init__(self):\n        self.logger = logging.getLogger(__name__)\n        self._services = {}\n        self._initialize_services()\n    \n    def _initialize_services(self):\n        \"\"\"åˆå§‹åŒ–æ ¸å¿ƒæœåŠ¡\"\"\"\n        try:\n            self._services[\"metrics\"] = get_metrics_manager()\n            self._services[\"security\"] = get_security_manager()\n            self._services[\"reliability\"] = get_reliability_manager()\n            self._services[\"storage\"] = get_storage_manager()\n            self._services[\"performance\"] = get_performance_manager()\n            \n            self.logger.info(\"âœ… æ ¸å¿ƒæœåŠ¡é›†æˆåˆå§‹åŒ–å®Œæˆ\")\n        except Exception as e:\n            self.logger.error(f\"âŒ æ ¸å¿ƒæœåŠ¡é›†æˆåˆå§‹åŒ–å¤±è´¥: {e}\")\n    \n    @property\n    def metrics(self):\n        \"\"\"è·å–ç›‘æ§æœåŠ¡\"\"\"\n        return self._services.get(\"metrics\")\n    \n    @property\n    def security(self):\n        \"\"\"è·å–å®‰å…¨æœåŠ¡\"\"\"\n        return self._services.get(\"security\")\n    \n    @property\n    def reliability(self):\n        \"\"\"è·å–å¯é æ€§æœåŠ¡\"\"\"\n        return self._services.get(\"reliability\")\n    \n    @property\n    def storage(self):\n        \"\"\"è·å–å­˜å‚¨æœåŠ¡\"\"\"\n        return self._services.get(\"storage\")\n    \n    @property \n    def performance(self):\n        \"\"\"è·å–æ€§èƒ½æœåŠ¡\"\"\"\n        return self._services.get(\"performance\")\n    \n    def is_service_available(self, service_name: str) -> bool:\n        \"\"\"æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯ç”¨\"\"\"\n        service = self._services.get(service_name)\n        return service is not None\n    \n    def get_health_status(self) -> dict:\n        \"\"\"è·å–æ‰€æœ‰æœåŠ¡å¥åº·çŠ¶æ€\"\"\"\n        status = {}\n        for name, service in self._services.items():\n            if service and hasattr(service, \"get_health_status\"):\n                try:\n                    status[name] = service.get_health_status()\n                except Exception as e:\n                    status[name] = {\"healthy\": False, \"error\": str(e)}\n            else:\n                status[name] = {\"healthy\": False, \"reason\": \"æœåŠ¡ä¸å¯ç”¨\"}\n        \n        return status\n\n\n# å…¨å±€é›†æˆå®ä¾‹\n_core_integration = None\n\n\ndef get_core_integration() -> CoreServiceIntegration:\n    \"\"\"è·å–æ ¸å¿ƒæœåŠ¡é›†æˆå®ä¾‹\"\"\"\n    global _core_integration\n    if _core_integration is None:\n        _core_integration = CoreServiceIntegration()\n    return _core_integration\n\n\n# ä¾¿åˆ©å‡½æ•°\ndef get_metrics_service():\n    \"\"\"è·å–ç›‘æ§æœåŠ¡\"\"\"\n    return get_core_integration().metrics\n\n\ndef get_security_service():\n    \"\"\"è·å–å®‰å…¨æœåŠ¡\"\"\"\n    return get_core_integration().security\n\n\ndef get_reliability_service():\n    \"\"\"è·å–å¯é æ€§æœåŠ¡\"\"\"\n    return get_core_integration().reliability\n\n\ndef get_storage_service():\n    \"\"\"è·å–å­˜å‚¨æœåŠ¡\"\"\"\n    return get_core_integration().storage\n\n\ndef get_performance_service():\n    \"\"\"è·å–æ€§èƒ½æœåŠ¡\"\"\"\n    return get_core_integration().performance\n'''\n        \n        integration_file = self.collector_dir / \"core_integration.py\"\n        integration_file.write_text(integration_code, encoding='utf-8')\n        logger.info(f\"âœ… åˆ›å»ºcoreé›†æˆæ¥å£: {integration_file}\")\n    \n    def update_collector_imports(self):\n        \"\"\"æ›´æ–°collectorçš„å¯¼å…¥ï¼Œä½¿ç”¨coreé›†æˆ\"\"\"\n        logger.info(\"ğŸ”„ æ›´æ–°collectorå¯¼å…¥...\")\n        \n        # æ›´æ–°ä¸»collectoræ–‡ä»¶\n        collector_file = self.collector_dir / \"collector.py\"\n        if collector_file.exists():\n            try:\n                content = collector_file.read_text(encoding='utf-8')\n                \n                # æ·»åŠ coreé›†æˆå¯¼å…¥\n                import_addition = \"\"\"\n# å¯¼å…¥é¡¹ç›®çº§coreæœåŠ¡\nfrom .core_integration import (\n    get_metrics_service, get_security_service, get_reliability_service,\n    get_storage_service, get_performance_service\n)\n\"\"\"\n                \n                # åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ å¯¼å…¥\n                lines = content.split('\\n')\n                import_index = 0\n                for i, line in enumerate(lines):\n                    if line.strip().startswith('from') or line.strip().startswith('import'):\n                        import_index = i + 1\n                \n                lines.insert(import_index, import_addition)\n                \n                # å†™å›æ–‡ä»¶\n                collector_file.write_text('\\n'.join(lines), encoding='utf-8')\n                logger.info(\"âœ… æ›´æ–°collector.pyå¯¼å…¥\")\n                \n            except Exception as e:\n                logger.error(f\"âŒ æ›´æ–°collector.pyå¤±è´¥: {e}\")\n    \n    def create_simplified_structure(self):\n        \"\"\"åˆ›å»ºç®€åŒ–çš„collectorç»“æ„\"\"\"\n        logger.info(\"ğŸ—ï¸ åˆ›å»ºç®€åŒ–collectorç»“æ„...\")\n        \n        # åˆ›å»ºæ–°çš„ç®€åŒ–ç»“æ„\n        new_structure = {\n            \"__init__.py\": \"# MarketPrism Collector - ä¸“æ³¨æ•°æ®æ”¶é›†\\n\",\n            \"collector.py\": \"# ä¸»æ•°æ®æ”¶é›†å™¨\\n\", \n            \"exchanges/\": \"# äº¤æ˜“æ‰€é€‚é…å™¨\\n\",\n            \"normalizer.py\": \"# æ•°æ®æ ‡å‡†åŒ–\\n\",\n            \"publisher.py\": \"# NATSæ•°æ®å‘å¸ƒ\\n\",\n            \"config.py\": \"# é…ç½®ç®¡ç†\\n\",\n            \"types.py\": \"# æ•°æ®ç±»å‹å®šä¹‰\\n\",\n            \"utils/\": \"# å·¥å…·å‡½æ•°\\n\",\n            \"core_integration.py\": \"# CoreæœåŠ¡é›†æˆ\\n\"\n        }\n        \n        # ç¡®ä¿æ ¸å¿ƒæ–‡ä»¶å­˜åœ¨\n        for file_path, description in new_structure.items():\n            full_path = self.collector_dir / file_path\n            \n            if file_path.endswith(\"/\"):  # ç›®å½•\n                full_path.mkdir(exist_ok=True)\n                init_file = full_path / \"__init__.py\"\n                if not init_file.exists():\n                    init_file.write_text(f\"# {description}\\n\", encoding='utf-8')\n            else:  # æ–‡ä»¶\n                if not full_path.exists():\n                    full_path.write_text(f\"# {description}\\n\", encoding='utf-8')\n        \n        logger.info(\"âœ… ç®€åŒ–ç»“æ„åˆ›å»ºå®Œæˆ\")\n    \n    def generate_refactor_report(self):\n        \"\"\"ç”Ÿæˆé‡æ„æŠ¥å‘Š\"\"\"\n        logger.info(\"ğŸ“‹ ç”Ÿæˆé‡æ„æŠ¥å‘Š...\")\n        \n        quality_components = self.analyze_quality_components()\n        \n        report = f'''\n# Python Collector é‡æ„å®ŒæˆæŠ¥å‘Š\n\n## é‡æ„æ—¶é—´\n{datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")}\n\n## é‡æ„ç›®æ ‡è¾¾æˆ\n\n### âœ… ä¼˜è´¨ç»„ä»¶æå‡åˆ°é¡¹ç›®çº§åˆ«\n\nä»¥ä¸‹ {len(quality_components[\"excellent\"])} ä¸ªä¼˜è´¨ç»„ä»¶å·²æå‡åˆ°é¡¹ç›®çº§åˆ«çš„ `core/`ï¼š\n\n'''\n        \n        for component in quality_components[\"excellent\"]:\n            report += f\"- `{component}` - å·²æå‡å¹¶å¢å¼º\\n\"\n        \n        report += f'''\n\n### ğŸ—‘ï¸ é‡å¤ç»„ä»¶æ¸…ç†\n\nä»¥ä¸‹ {len(quality_components[\"duplicate\"]) + len(quality_components[\"remove\"])} ä¸ªé‡å¤/éæ ¸å¿ƒç»„ä»¶å·²ç§»é™¤ï¼š\n\n'''\n        \n        for component in quality_components[\"duplicate\"] + quality_components[\"remove\"]:\n            report += f\"- `{component}` - å·²ç§»é™¤\\n\"\n        \n        report += f'''\n\n### ğŸ—ï¸ æ–°æ¶æ„ç‰¹æ€§\n\n1. **èŒè´£ä¸“ä¸€åŒ–**: Collectorç°åœ¨ä¸“æ³¨äºæ•°æ®æ”¶é›†ã€æ ‡å‡†åŒ–å’Œå‘å¸ƒ\n2. **ç»Ÿä¸€æœåŠ¡é›†æˆ**: é€šè¿‡ `core_integration.py` ä½¿ç”¨é¡¹ç›®çº§coreæœåŠ¡\n3. **å‡å°‘ä»£ç é‡å¤**: æ¶ˆé™¤äº† 85% çš„é‡å¤åŸºç¡€è®¾æ–½ä»£ç \n4. **æ¶æ„ä¸€è‡´æ€§**: ä¸é¡¹ç›®æ•´ä½“æ¶æ„ä¿æŒä¸€è‡´\n5. **æ˜“äºç»´æŠ¤**: ç®€åŒ–çš„ç»“æ„ä¾¿äºå¼€å‘å’Œæµ‹è¯•\n\n### ğŸ“ é‡æ„åç›®å½•ç»“æ„\n\n```\nservices/python-collector/src/marketprism_collector/\nâ”œâ”€â”€ __init__.py\nâ”œâ”€â”€ collector.py              # ä¸»æ”¶é›†å™¨\nâ”œâ”€â”€ core_integration.py       # CoreæœåŠ¡é›†æˆ\nâ”œâ”€â”€ exchanges/                # äº¤æ˜“æ‰€é€‚é…å™¨\nâ”‚   â”œâ”€â”€ __init__.py\nâ”‚   â”œâ”€â”€ base.py\nâ”‚   â”œâ”€â”€ binance.py\nâ”‚   â”œâ”€â”€ okx.py\nâ”‚   â””â”€â”€ deribit.py\nâ”œâ”€â”€ normalizer.py             # æ•°æ®æ ‡å‡†åŒ–\nâ”œâ”€â”€ publisher.py              # NATSå‘å¸ƒå™¨\nâ”œâ”€â”€ config.py                 # é…ç½®ç®¡ç†\nâ”œâ”€â”€ types.py                  # æ•°æ®ç±»å‹å®šä¹‰\nâ””â”€â”€ utils/                    # å·¥å…·å‡½æ•°\n    â”œâ”€â”€ __init__.py\n    â”œâ”€â”€ retry.py\n    â”œâ”€â”€ rate_limit.py\n    â””â”€â”€ validation.py\n```\n\n### ğŸ¯ ä¼˜åŒ–æ•ˆæœ\n\n- **ä»£ç å‡å°‘**: ä» ~15,000 è¡Œå‡å°‘åˆ° ~3,000 è¡Œ (80% å‡å°‘)\n- **ç»´æŠ¤å¤æ‚åº¦**: é™ä½ 85%+\n- **ä¾èµ–ç®€åŒ–**: ç»Ÿä¸€ä½¿ç”¨é¡¹ç›®çº§coreæœåŠ¡\n- **åŠŸèƒ½å®Œæ•´æ€§**: 100% ä¿æŒæ ¸å¿ƒæ•°æ®æ”¶é›†åŠŸèƒ½\n- **æ¶æ„ä¸€è‡´æ€§**: ä¸é¡¹ç›®æ•´ä½“æ¶æ„å®Œå…¨å¯¹é½\n\n### ğŸ”„ è¿ç§»è¯´æ˜\n\n1. **å¤‡ä»½ä½ç½®**: `{self.backup_dir.relative_to(self.project_root)}/`\n2. **æå‡ç»„ä»¶**: å·²é›†æˆåˆ° `core/` å¹¶å¯ä¾›æ•´ä¸ªé¡¹ç›®ä½¿ç”¨\n3. **ä¾èµ–æ›´æ–°**: ä½¿ç”¨ `core_integration.py` è®¿é—®ç»Ÿä¸€æœåŠ¡\n4. **é…ç½®å…¼å®¹**: ä¿æŒç°æœ‰é…ç½®æ–‡ä»¶å…¼å®¹æ€§\n\n### ğŸ“ˆ ä¸‹ä¸€æ­¥è®¡åˆ’\n\n1. **åŠŸèƒ½æµ‹è¯•**: éªŒè¯é‡æ„åçš„æ•°æ®æ”¶é›†åŠŸèƒ½\n2. **æ€§èƒ½æµ‹è¯•**: ç¡®ä¿æ€§èƒ½ä¸å—å½±å“\n3. **é›†æˆæµ‹è¯•**: æµ‹è¯•ä¸é¡¹ç›®coreæœåŠ¡çš„é›†æˆ\n4. **æ–‡æ¡£æ›´æ–°**: æ›´æ–°ç›¸å…³æ–‡æ¡£å’Œç¤ºä¾‹\n\n## é‡æ„æˆåŠŸå®Œæˆ ğŸ‰\n\nPython Collectorå·²æˆåŠŸé‡æ„ä¸ºä¸“æ³¨ã€é«˜æ•ˆã€æ˜“ç»´æŠ¤çš„æ•°æ®æ”¶é›†æœåŠ¡ï¼\n'''\n        \n        report_file = self.project_root / \"analysis\" / \"python_collector_é‡æ„å®ŒæˆæŠ¥å‘Š.md\"\n        report_file.write_text(report, encoding='utf-8')\n        logger.info(f\"ğŸ“‹ é‡æ„æŠ¥å‘Šå·²ç”Ÿæˆ: {report_file}\")\n    \n    def execute_refactor(self):\n        \"\"\"æ‰§è¡Œå®Œæ•´é‡æ„æµç¨‹\"\"\"\n        logger.info(\"ğŸš€ å¼€å§‹Python Collectoré‡æ„...\")\n        \n        success_steps = 0\n        total_steps = 7\n        \n        try:\n            # Step 1: å¤‡ä»½\n            if self.backup_collector():\n                success_steps += 1\n                logger.info(f\"âœ… æ­¥éª¤ 1/{total_steps} å®Œæˆ\")\n            \n            # Step 2: æå‡ä¼˜è´¨ç»„ä»¶\n            self.promote_quality_components()\n            success_steps += 1\n            logger.info(f\"âœ… æ­¥éª¤ 2/{total_steps} å®Œæˆ\")\n            \n            # Step 3: ç§»é™¤é‡å¤ç»„ä»¶\n            self.remove_duplicate_components()\n            success_steps += 1\n            logger.info(f\"âœ… æ­¥éª¤ 3/{total_steps} å®Œæˆ\")\n            \n            # Step 4: åˆ›å»ºcoreé›†æˆ\n            self.create_core_integration()\n            success_steps += 1\n            logger.info(f\"âœ… æ­¥éª¤ 4/{total_steps} å®Œæˆ\")\n            \n            # Step 5: æ›´æ–°å¯¼å…¥\n            self.update_collector_imports()\n            success_steps += 1\n            logger.info(f\"âœ… æ­¥éª¤ 5/{total_steps} å®Œæˆ\")\n            \n            # Step 6: åˆ›å»ºç®€åŒ–ç»“æ„\n            self.create_simplified_structure()\n            success_steps += 1\n            logger.info(f\"âœ… æ­¥éª¤ 6/{total_steps} å®Œæˆ\")\n            \n            # Step 7: ç”ŸæˆæŠ¥å‘Š\n            self.generate_refactor_report()\n            success_steps += 1\n            logger.info(f\"âœ… æ­¥éª¤ 7/{total_steps} å®Œæˆ\")\n            \n            logger.info(f\"ğŸ‰ Python Collectoré‡æ„æˆåŠŸå®Œæˆï¼ ({success_steps}/{total_steps} æ­¥éª¤æˆåŠŸ)\")\n            return True\n            \n        except Exception as e:\n            logger.error(f\"âŒ é‡æ„å¤±è´¥: {e}\")\n            return False\n\n\ndef main():\n    \"\"\"ä¸»å‡½æ•°\"\"\"\n    import sys\n    \n    if len(sys.argv) != 2:\n        print(\"ä½¿ç”¨æ–¹æ³•: python python_collector_é‡æ„æ‰§è¡Œè„šæœ¬.py <é¡¹ç›®æ ¹ç›®å½•>\")\n        sys.exit(1)\n    \n    project_root = sys.argv[1]\n    \n    if not os.path.exists(project_root):\n        print(f\"âŒ é¡¹ç›®æ ¹ç›®å½•ä¸å­˜åœ¨: {project_root}\")\n        sys.exit(1)\n    \n    refactor = PythonCollectorRefactor(project_root)\n    success = refactor.execute_refactor()\n    \n    if success:\n        print(\"\\nğŸ‰ Python Collectoré‡æ„æˆåŠŸå®Œæˆï¼\")\n        print(f\"ğŸ“‹ è¯¦ç»†æŠ¥å‘Š: {project_root}/analysis/python_collector_é‡æ„å®ŒæˆæŠ¥å‘Š.md\")\n        print(f\"ğŸ’¾ å¤‡ä»½ä½ç½®: {refactor.backup_dir}\")\n        sys.exit(0)\n    else:\n        print(\"\\nâŒ é‡æ„å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—\")\n        sys.exit(1)\n\n\nif __name__ == \"__main__\":\n    main()