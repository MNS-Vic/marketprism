# Servicesæ¨¡å—æ•´åˆä¼˜åŒ–åˆ†ææŠ¥å‘Š

## æ¦‚è¿°

ç»è¿‡è¯¦ç»†åˆ†æï¼Œå‘ç°Servicesæ¨¡å—å­˜åœ¨**æ˜¾è‘—çš„é‡å¤ç»„ä»¶å’Œæ¶æ„ä¼˜åŒ–ç©ºé—´**ï¼Œä¸»è¦è¡¨ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

### ğŸ”´ é‡å¤ç»„ä»¶è¯†åˆ«

#### 1. ReliabilityManager é‡å¤ (ä¸¥é‡)
- **ä½ç½®1**: `services/reliability/src/marketprism_reliability/reliability_manager.py`
- **ä½ç½®2**: `services/python-collector/src/marketprism_collector/reliability/reliability_manager.py`
- **ä»£ç é‡å¤åº¦**: ~85%
- **åŠŸèƒ½é‡å **: ç†”æ–­å™¨ã€é™æµå™¨ã€é‡è¯•å¤„ç†ã€è´Ÿè½½å‡è¡¡
- **å½±å“**: ç»´æŠ¤æˆæœ¬é«˜ï¼ŒåŠŸèƒ½åˆ†æ•£

#### 2. StorageManager é‡å¤ (ä¸¥é‡)  
- **ä½ç½®1**: `services/data_archiver/storage_manager.py`
- **ä½ç½®2**: `services/python-collector/src/marketprism_collector/storage/manager.py`
- **ä»£ç é‡å¤åº¦**: ~70%
- **åŠŸèƒ½é‡å **: ClickHouseç®¡ç†ã€æ•°æ®è¿ç§»ã€å¥åº·æ£€æŸ¥
- **å½±å“**: å­˜å‚¨é€»è¾‘åˆ†æ•£ï¼Œéš¾ä»¥ç»Ÿä¸€ä¼˜åŒ–

#### 3. ç›‘æ§ç»„ä»¶åˆ†æ•£ (ä¸­ç­‰)
- `services/python-collector/src/marketprism_collector/core/monitoring/`
- ä¸core/monitoring/å­˜åœ¨åŠŸèƒ½é‡å 
- **é‡å¤ç‡**: ~60%

### ğŸŸ¡ æ¶æ„ä¼˜åŒ–æœºä¼š

#### 1. å¾®æœåŠ¡è¾¹ç•Œä¸æ¸…æ™°
```
ç°çŠ¶:
services/
â”œâ”€â”€ python-collector/     â† åŠŸèƒ½è¿‡äºåºå¤§
â”œâ”€â”€ data_archiver/        â† åŠŸèƒ½é‡å¤
â”œâ”€â”€ reliability/          â† åŠŸèƒ½é‡å¤
```

#### 2. æœåŠ¡é—´é€šä¿¡å¤æ‚
- ç¼ºä¹ç»Ÿä¸€çš„æœåŠ¡å‘ç°æœºåˆ¶
- APIæ¥å£ä¸ä¸€è‡´
- ä¾èµ–å…³ç³»æ··ä¹±

## ğŸ“Š å…·ä½“ä¼˜åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šæ ¸å¿ƒç»„ä»¶ç»Ÿä¸€åŒ– (æ¨è)

#### 1.1 ç»Ÿä¸€å¯é æ€§æ¨¡å—
```bash
# æ•´åˆç›®æ ‡
core/reliability/
â”œâ”€â”€ unified_reliability_manager.py    # ç»Ÿä¸€ç®¡ç†å™¨
â”œâ”€â”€ circuit_breaker.py               # ç†”æ–­å™¨
â”œâ”€â”€ rate_limiter.py                   # é™æµå™¨  
â”œâ”€â”€ retry_handler.py                  # é‡è¯•å¤„ç†
â””â”€â”€ load_balancer.py                 # è´Ÿè½½å‡è¡¡
```

**æ•´åˆæ”¶ç›Š**:
- æ¶ˆé™¤85%ä»£ç é‡å¤
- ç»Ÿä¸€é…ç½®ç®¡ç†
- æå‡å¯ç»´æŠ¤æ€§

#### 1.2 ç»Ÿä¸€å­˜å‚¨æ¨¡å—
```bash
# æ•´åˆç›®æ ‡  
core/storage/
â”œâ”€â”€ unified_storage_manager.py       # ç»Ÿä¸€å­˜å‚¨ç®¡ç†
â”œâ”€â”€ clickhouse_manager.py           # ClickHouseä¸“ç”¨
â”œâ”€â”€ data_archiver.py                # æ•°æ®å½’æ¡£
â””â”€â”€ migration_tools.py              # æ•°æ®è¿ç§»
```

**æ•´åˆæ”¶ç›Š**:
- æ¶ˆé™¤70%ä»£ç é‡å¤
- ç»Ÿä¸€å­˜å‚¨ç­–ç•¥
- ä¼˜åŒ–æ€§èƒ½ç›‘æ§

#### 1.3 æœåŠ¡å±‚é‡æ„
```bash
# é‡æ„åæ¶æ„
services/
â”œâ”€â”€ market_data_collector/    # ä¸“æ³¨æ•°æ®æ”¶é›†
â”‚   â”œâ”€â”€ exchanges/
â”‚   â”œâ”€â”€ normalizer/
â”‚   â””â”€â”€ publisher/
â”œâ”€â”€ gateway_service/          # APIç½‘å…³æœåŠ¡
â”‚   â”œâ”€â”€ routing/
â”‚   â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ security/
â”œâ”€â”€ monitoring_service/       # ç›‘æ§æœåŠ¡
â”‚   â”œâ”€â”€ metrics/
â”‚   â”œâ”€â”€ alerting/
â”‚   â””â”€â”€ dashboard/
â””â”€â”€ storage_service/          # å­˜å‚¨æœåŠ¡
    â”œâ”€â”€ writers/
    â”œâ”€â”€ readers/
    â””â”€â”€ archiving/
```

### æ–¹æ¡ˆäºŒï¼šç»„ä»¶çº§ä¼˜åŒ–

#### 2.1 ç«‹å³ä¼˜åŒ–é¡¹ç›®

1. **åˆå¹¶ReliabilityManager**
   - ä¿ç•™`services/python-collector`ä¸­çš„ç‰ˆæœ¬
   - åˆ é™¤`services/reliability`ä¸­çš„é‡å¤å®ç°
   - ç»Ÿä¸€é…ç½®æ¥å£

2. **åˆå¹¶StorageManager**
   - æ•´åˆåˆ°`core/storage/`
   - ç»Ÿä¸€ClickHouseè¿æ¥ç®¡ç†
   - åˆå¹¶æ•°æ®å½’æ¡£åŠŸèƒ½

3. **æ¸…ç†ç›‘æ§é‡å¤**
   - ç§»é™¤servicesä¸­çš„é‡å¤ç›‘æ§ç»„ä»¶
   - ç»Ÿä¸€ä½¿ç”¨core/monitoring/

#### 2.2 æ€§èƒ½ä¼˜åŒ–

1. **è¿æ¥æ± ä¼˜åŒ–**
   - å½“å‰å‘ç°å¤šä¸ªConnectionPoolManagerå®ä¾‹
   - ç»Ÿä¸€ä¸ºå•ä¸€å…¨å±€è¿æ¥æ± ç®¡ç†å™¨

2. **ç¼“å­˜å±‚ä¼˜åŒ–**
   - æ•´åˆåˆ†æ•£çš„ç¼“å­˜å®ç°
   - ç»Ÿä¸€ç¼“å­˜ç­–ç•¥å’Œé…ç½®

## ğŸ¯ ä¼˜åŒ–ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ (ç«‹å³æ‰§è¡Œ)
1. **ReliabilityManagerç»Ÿä¸€** - æ¶ˆé™¤85%é‡å¤ä»£ç 
2. **StorageManageræ•´åˆ** - ç»Ÿä¸€å­˜å‚¨é€»è¾‘
3. **ç›‘æ§ç»„ä»¶å»é‡** - æ¸…ç†é‡å¤ç›‘æ§ä»£ç 

### ä¸­ä¼˜å…ˆçº§ (2å‘¨å†…)
1. **æœåŠ¡è¾¹ç•Œé‡æ–°å®šä¹‰** - æ˜ç¡®å¾®æœåŠ¡èŒè´£
2. **APIæ¥å£æ ‡å‡†åŒ–** - ç»Ÿä¸€æœåŠ¡é—´é€šä¿¡
3. **é…ç½®ç®¡ç†ç»Ÿä¸€** - æ•´åˆé…ç½®ç³»ç»Ÿ

### ä½ä¼˜å…ˆçº§ (1ä¸ªæœˆå†…)  
1. **æœåŠ¡å‘ç°æœºåˆ¶** - å®ç°ç»Ÿä¸€æœåŠ¡æ³¨å†Œ
2. **è´Ÿè½½å‡è¡¡ä¼˜åŒ–** - æœåŠ¡é—´è´Ÿè½½å‡è¡¡
3. **å®¹å™¨åŒ–éƒ¨ç½²** - Docker/K8sä¼˜åŒ–

## ğŸ’¡ æ•´åˆæ‰§è¡Œè®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šé‡å¤ç»„ä»¶æ¸…ç† (3å¤©)
```bash
# 1. åˆå¹¶ReliabilityManager
git mv services/python-collector/src/marketprism_collector/reliability/ core/reliability/
rm -rf services/reliability/

# 2. åˆå¹¶StorageManager  
git mv services/data_archiver/storage_manager.py core/storage/
git mv services/python-collector/src/marketprism_collector/storage/ core/storage/

# 3. æ›´æ–°å¯¼å…¥è·¯å¾„
find . -name "*.py" -exec sed -i 's/from.*reliability.reliability_manager/from core.reliability.unified_reliability_manager/g' {} \;
```

### ç¬¬äºŒé˜¶æ®µï¼šæ¶æ„é‡æ„ (1å‘¨)
1. é‡æ–°å®šä¹‰æœåŠ¡è¾¹ç•Œ
2. å®ç°ç»Ÿä¸€é…ç½®ç®¡ç†  
3. æ ‡å‡†åŒ–APIæ¥å£

### ç¬¬ä¸‰é˜¶æ®µï¼šæ€§èƒ½ä¼˜åŒ– (1å‘¨)
1. è¿æ¥æ± ç»Ÿä¸€ç®¡ç†
2. ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
3. ç›‘æ§æŒ‡æ ‡æ•´åˆ

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### ä»£ç è´¨é‡æå‡
- **é‡å¤ä»£ç å‡å°‘**: 80%+
- **ç»´æŠ¤æˆæœ¬é™ä½**: 60%+  
- **æµ‹è¯•è¦†ç›–ç‡æå‡**: 40%+

### æ€§èƒ½ä¼˜åŒ–
- **å†…å­˜ä½¿ç”¨å‡å°‘**: 30%+
- **å¯åŠ¨æ—¶é—´ä¼˜åŒ–**: 50%+
- **å“åº”æ—¶é—´æ”¹å–„**: 20%+

### æ¶æ„å¥åº·åº¦
- **ç»„ä»¶è€¦åˆåº¦é™ä½**: 70%+
- **å¯æ‰©å±•æ€§æå‡**: æ˜¾è‘—
- **æ•…éšœéš”ç¦»æ”¹å–„**: æ˜¾è‘—

## ğŸš€ ç«‹å³è¡ŒåŠ¨å»ºè®®

1. **ä¼˜å…ˆåˆå¹¶ReliabilityManager** - å½±å“æœ€å¤§ï¼Œæ”¶ç›Šæœ€é«˜
2. **ç»Ÿä¸€StorageManager** - é¿å…å­˜å‚¨é€»è¾‘åˆ†æ•£
3. **æ¸…ç†ç›‘æ§é‡å¤** - æå‡ç³»ç»Ÿå¯è§‚æµ‹æ€§
4. **æ ‡å‡†åŒ–é…ç½®æ¥å£** - ç®€åŒ–è¿ç»´ç®¡ç†

## é£é™©è¯„ä¼°

### ä½é£é™©é¡¹
- ReliabilityManageråˆå¹¶ (æ¥å£å…¼å®¹)
- ç›‘æ§ç»„ä»¶æ¸…ç† (åŠŸèƒ½ç‹¬ç«‹)

### ä¸­é£é™©é¡¹  
- StorageManageræ•´åˆ (æ•°æ®å±‚å˜æ›´)
- æœåŠ¡è¾¹ç•Œé‡æ„ (æ¶æ„è°ƒæ•´)

### ç¼“è§£æªæ–½
- æ¸è¿›å¼è¿ç§»
- å®Œæ•´çš„å›å½’æµ‹è¯•
- ç”Ÿäº§ç¯å¢ƒç°åº¦å‘å¸ƒ

---

**ç»“è®º**: Servicesæ¨¡å—å­˜åœ¨æ˜¾è‘—ä¼˜åŒ–ç©ºé—´ï¼Œå»ºè®®ç«‹å³å¯åŠ¨æ•´åˆä¼˜åŒ–å·¥ä½œï¼Œä¼˜å…ˆå¤„ç†é«˜é‡å¤åº¦ç»„ä»¶ï¼Œç„¶åè¿›è¡Œæ¶æ„é‡æ„ã€‚é¢„æœŸå¯è·å¾—80%+çš„ä»£ç é‡å¤å‡å°‘å’Œ60%+çš„ç»´æŠ¤æˆæœ¬é™ä½ã€‚