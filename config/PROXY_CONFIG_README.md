# MarketPrism 代理配置说明\n\n## 概述\n\nMarketPrism支持为不同类型的网络连接配置不同的代理类型：\n- **REST API**: 使用HTTP/HTTPS代理\n- **WebSocket**: 使用SOCKS代理\n\n所有代理设置都统一在主配置文件 `config/collector_config.yaml` 中管理，所有交易所共享同一套代理配置。\n\n## 统一代理配置\n\n### 主配置文件 (`config/collector_config.yaml`)\n\n```yaml\nproxy:\n  enabled: true\n  # REST API使用HTTP代理\n  rest_api:\n    http_proxy: \"http://127.0.0.1:7890\"\n    https_proxy: \"http://127.0.0.1:7890\"\n  # WebSocket使用SOCKS代理\n  websocket:\n    socks_proxy: \"socks5://127.0.0.1:7891\"\n  # 不使用代理的地址\n  no_proxy: \"localhost,127.0.0.1\"\n  # 兼容性配置（向后兼容）\n  http_proxy: \"http://127.0.0.1:7890\"\n  https_proxy: \"http://127.0.0.1:7890\"\n```\n\n### 交易所配置文件\n\n交易所配置文件（如`binance_futures.yaml`, `okx.yaml`, `deribit.yaml`等）**不包含**代理配置。所有代理设置从主配置文件继承。\n\n## 代理类型说明\n\n### REST API 代理\n- **协议**: HTTP/HTTPS\n- **端口**: 7890 (默认)\n- **用途**: 处理REST API请求（如获取市场数据、账户信息等）\n- **优势**: HTTP代理对REST请求有更好的支持和缓存能力\n\n### WebSocket 代理\n- **协议**: SOCKS5\n- **端口**: 7891 (默认)\n- **用途**: 处理WebSocket连接（如实时数据流）\n- **优势**: SOCKS代理对WebSocket连接有更好的支持，延迟更低\n\n## 配置示例\n\n### 场景1: 使用Clash等代理工具\n\n```yaml\nproxy:\n  enabled: true\n  rest_api:\n    http_proxy: \"http://127.0.0.1:7890\"    # Clash HTTP端口\n    https_proxy: \"http://127.0.0.1:7890\"\n  websocket:\n    socks_proxy: \"socks5://127.0.0.1:7891\" # Clash SOCKS端口\n  no_proxy: \"localhost,127.0.0.1\"\n```\n\n### 场景2: 使用V2Ray等代理工具\n\n```yaml\nproxy:\n  enabled: true\n  rest_api:\n    http_proxy: \"http://127.0.0.1:8080\"    # V2Ray HTTP端口\n    https_proxy: \"http://127.0.0.1:8080\"\n  websocket:\n    socks_proxy: \"socks5://127.0.0.1:1080\" # V2Ray SOCKS端口\n  no_proxy: \"localhost,127.0.0.1\"\n```\n\n### 场景3: 禁用代理\n\n```yaml\nproxy:\n  enabled: false\n```\n\n## 应用程序支持\n\n### Python代码中的使用\n\n```python\n# 加载主配置文件\nwith open('config/collector_config.yaml', 'r') as f:\n    config = yaml.safe_load(f)\n\n# 获取REST API代理设置\nrest_proxy = config.get('proxy', {}).get('rest_api', {})\nhttp_proxy = rest_proxy.get('http_proxy')\nhttps_proxy = rest_proxy.get('https_proxy')\n\n# 获取WebSocket代理设置\nws_proxy = config.get('proxy', {}).get('websocket', {})\nsocks_proxy = ws_proxy.get('socks_proxy')\n\n# 兼容性回退\nif not http_proxy:\n    http_proxy = config.get('proxy', {}).get('http_proxy')\nif not https_proxy:\n    https_proxy = config.get('proxy', {}).get('https_proxy')\n```\n\n## 配置管理优势\n\n### 统一配置的好处\n\n1. **简化管理**: 只需在一个地方配置代理设置\n2. **一致性**: 所有交易所使用相同的代理配置\n3. **易于维护**: 修改代理设置时只需更新主配置文件\n4. **减少错误**: 避免在多个文件中重复配置造成的不一致\n\n### 配置继承机制\n\n- 主配置文件包含全局代理设置\n- 所有交易所适配器自动从主配置继承代理设置\n- 支持运行时动态更新代理配置\n\n## 注意事项\n\n1. **端口冲突**: 确保HTTP代理和SOCKS代理使用不同的端口\n2. **代理工具配置**: 确保你的代理工具（如Clash、V2Ray等）同时开启HTTP和SOCKS端口\n3. **网络测试**: 配置完成后建议测试连接以确保代理正常工作\n4. **安全性**: 代理配置中的密码和认证信息应该通过环境变量或其他安全方式管理\n\n## 故障排除\n\n### 常见问题\n\n1. **连接超时**: 检查代理端口是否正确开启\n2. **认证失败**: 确认代理工具的认证设置\n3. **DNS解析问题**: 检查`no_proxy`设置是否正确\n\n### 调试步骤\n\n1. 测试HTTP代理：`curl --proxy http://127.0.0.1:7890 https://httpbin.org/ip`\n2. 测试SOCKS代理：`curl --proxy socks5://127.0.0.1:7891 https://httpbin.org/ip`\n3. 检查代理工具日志\n4. 验证代理端口监听状态：`netstat -an | grep 7890`\n\n## 更新历史\n\n- **2025-06-02**: 统一代理配置管理，移除交易所配置文件中的重复代理设置\n"