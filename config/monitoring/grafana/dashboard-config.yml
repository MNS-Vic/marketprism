# MarketPrism Grafana仪表板优化配置
# 定义仪表板布局、性能优化和用户体验改进

# 仪表板分类和组织
dashboard_categories:
  # 主监控仪表板
  main_monitoring:
    name: "MarketPrism 主监控"
    description: "系统整体状态和关键指标监控"
    file: "marketprism-optimized-dashboard.json"
    priority: 1
    refresh_interval: "30s"
    auto_refresh: true
    
  # 性能基线监控
  performance_baseline:
    name: "性能基线监控"
    description: "性能基线对比和异常检测"
    file: "marketprism-performance-baseline-dashboard.json"
    priority: 2
    refresh_interval: "1m"
    auto_refresh: true
    
  # 告警管理监控
  alert_management:
    name: "告警管理监控"
    description: "告警降噪和管理效果监控"
    file: "marketprism-alert-management-dashboard.json"
    priority: 3
    refresh_interval: "30s"
    auto_refresh: true
    
  # 详细监控仪表板
  detailed_monitoring:
    name: "详细系统监控"
    description: "详细的系统和服务监控"
    file: "marketprism-monitoring-dashboard.json"
    priority: 4
    refresh_interval: "1m"
    auto_refresh: false

# 仪表板性能优化配置
performance_optimization:
  # 查询优化
  query_optimization:
    # 时间范围限制
    max_time_range: "7d"          # 最大查询时间范围
    default_time_range: "1h"      # 默认时间范围
    
    # 查询间隔优化
    query_intervals:
      real_time: "15s"            # 实时数据查询间隔
      near_real_time: "1m"        # 近实时数据查询间隔
      historical: "5m"            # 历史数据查询间隔
      
    # 数据点限制
    max_data_points: 1000         # 最大数据点数
    min_interval: "15s"           # 最小查询间隔
    
    # 查询超时
    query_timeout: "30s"          # 查询超时时间
    
  # 缓存配置
  caching:
    enabled: true
    cache_duration: "5m"          # 缓存持续时间
    cache_size: "100MB"           # 缓存大小限制
    
  # 并发控制
  concurrency:
    max_concurrent_queries: 10    # 最大并发查询数
    query_queue_size: 50          # 查询队列大小

# 用户体验优化
user_experience:
  # 响应式设计
  responsive_design:
    enabled: true
    breakpoints:
      mobile: "768px"
      tablet: "1024px"
      desktop: "1200px"
      
  # 主题配置
  theme:
    default: "dark"               # 默认主题
    allow_user_change: true       # 允许用户更改主题
    
  # 导航优化
  navigation:
    # 仪表板分组
    groups:
      - name: "核心监控"
        dashboards:
          - "marketprism-optimized-dashboard"
          - "marketprism-performance-baseline-dashboard"
          - "marketprism-alert-management-dashboard"
      - name: "详细分析"
        dashboards:
          - "marketprism-monitoring-dashboard"
          - "marketprism-simple-dashboard"
    
    # 快速访问链接
    quick_links:
      - name: "系统概览"
        url: "/d/marketprism-optimized"
      - name: "性能基线"
        url: "/d/marketprism-performance-baseline"
      - name: "告警管理"
        url: "/d/marketprism-alert-management"
        
  # 自动刷新配置
  auto_refresh:
    enabled: true
    intervals: ["5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h"]
    default: "30s"

# 面板优化配置
panel_optimization:
  # 通用面板设置
  common_settings:
    # 图表性能
    max_series: 20                # 最大时间序列数
    max_points_per_series: 1000   # 每个序列最大点数
    
    # 颜色配置
    color_scheme: "palette-classic"
    transparency: 10              # 填充透明度
    
    # 图例配置
    legend:
      enabled: true
      position: "bottom"
      max_items: 10
      
  # 特定面板类型优化
  panel_types:
    # 时间序列图表
    timeseries:
      line_width: 2
      point_size: 5
      fill_opacity: 10
      gradient_mode: "none"
      
    # 统计面板
    stat:
      color_mode: "background"
      graph_mode: "area"
      justify_mode: "center"
      
    # 表格面板
    table:
      page_size: 50
      sortable: true
      filterable: true
      
    # 热力图
    heatmap:
      bucket_size: "auto"
      color_scheme: "interpolateSpectral"

# 告警集成优化
alert_integration:
  # 仪表板告警显示
  dashboard_alerts:
    enabled: true
    show_annotations: true
    alert_threshold_lines: true
    
  # 告警状态指示器
  status_indicators:
    enabled: true
    positions: ["top-right", "panel-header"]
    colors:
      firing: "red"
      pending: "yellow"
      resolved: "green"
      
  # 告警历史
  alert_history:
    enabled: true
    retention_period: "30d"
    max_events: 1000

# 数据源优化
datasource_optimization:
  # Prometheus优化
  prometheus:
    # 查询优化
    query_optimization:
      use_recording_rules: true   # 使用记录规则
      prefer_instant_queries: false
      
    # 连接池配置
    connection_pool:
      max_idle_connections: 10
      max_open_connections: 20
      connection_timeout: "30s"
      
    # 缓存配置
    cache:
      enabled: true
      ttl: "5m"
      
  # Loki优化 (如果使用)
  loki:
    query_optimization:
      max_query_length: "24h"
      max_query_size: "100MB"
      
# 监控和分析
monitoring:
  # 仪表板使用统计
  usage_analytics:
    enabled: true
    track_views: true
    track_query_performance: true
    track_user_interactions: true
    
  # 性能监控
  performance_monitoring:
    enabled: true
    metrics:
      - "dashboard_load_time"
      - "query_execution_time"
      - "panel_render_time"
      - "user_interaction_latency"
      
  # 错误监控
  error_monitoring:
    enabled: true
    log_query_errors: true
    alert_on_errors: true
    error_threshold: 5            # 错误阈值

# 自动化和维护
automation:
  # 自动备份
  backup:
    enabled: true
    schedule: "0 2 * * *"         # 每天凌晨2点备份
    retention: "30d"              # 备份保留30天
    
  # 自动优化
  auto_optimization:
    enabled: true
    schedule: "0 3 * * 0"         # 每周日凌晨3点优化
    actions:
      - "cleanup_unused_panels"
      - "optimize_queries"
      - "update_thresholds"
      
  # 健康检查
  health_check:
    enabled: true
    interval: "5m"
    checks:
      - "datasource_connectivity"
      - "dashboard_accessibility"
      - "query_performance"

# 安全和权限
security:
  # 访问控制
  access_control:
    enabled: true
    default_role: "viewer"
    admin_users: ["admin"]
    
  # 仪表板权限
  dashboard_permissions:
    public_dashboards: ["marketprism-optimized-dashboard"]
    restricted_dashboards: ["marketprism-alert-management-dashboard"]
    
  # 数据安全
  data_security:
    mask_sensitive_data: true
    audit_access: true
    session_timeout: "8h"

# 集成配置
integrations:
  # Slack集成
  slack:
    enabled: true
    webhook_url: "${SLACK_WEBHOOK_URL}"
    channels:
      alerts: "#marketprism-alerts"
      performance: "#marketprism-performance"
      
  # 邮件集成
  email:
    enabled: true
    smtp_host: "${SMTP_HOST}"
    smtp_port: 587
    
  # API集成
  api:
    enabled: true
    rate_limit: "100/hour"
    authentication: "token"
