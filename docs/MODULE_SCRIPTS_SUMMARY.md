# MarketPrism æ¨¡å—ç®¡ç†è„šæœ¬æ€»ç»“

## âœ… å®Œæˆæƒ…å†µ

å·²ä¸º MarketPrism çš„ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—åˆ›å»ºäº†ç‹¬ç«‹çš„ã€åŠŸèƒ½å®Œæ•´çš„ç®¡ç†è„šæœ¬ã€‚

---

## ğŸ“¦ åˆ›å»ºçš„è„šæœ¬

### 1. Message Broker ç®¡ç†è„šæœ¬
**è·¯å¾„**: `services/message-broker/scripts/manage.sh`

**åŠŸèƒ½**:
- âœ… è‡ªåŠ¨å®‰è£… NATS Server v2.10.7
- âœ… åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒ
- âœ… å®‰è£… Python ä¾èµ–ï¼ˆnats-py, PyYAMLï¼‰
- âœ… åˆå§‹åŒ– JetStream æµ
- âœ… å¯åŠ¨/åœæ­¢/é‡å¯ NATS Server
- âœ… çŠ¶æ€æ£€æŸ¥å’Œå¥åº·æ£€æŸ¥
- âœ… æ—¥å¿—æŸ¥çœ‹å’Œæ¸…ç†

**ç«¯å£**:
- 4222: NATS å®¢æˆ·ç«¯ç«¯å£
- 8222: NATS ç›‘æ§ç«¯å£

---

### 2. Data Storage Service ç®¡ç†è„šæœ¬
**è·¯å¾„**: `services/data-storage-service/scripts/manage.sh`

**åŠŸèƒ½**:
- âœ… è‡ªåŠ¨å®‰è£… ClickHouse v25.10.1
- âœ… åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒ
- âœ… å®‰è£… Python ä¾èµ–ï¼ˆnats-py, aiohttp, clickhouse-driver, structlogï¼‰
- âœ… åˆå§‹åŒ– ClickHouse æ•°æ®åº“è¡¨ç»“æ„
- âœ… å¯åŠ¨/åœæ­¢/é‡å¯å­˜å‚¨æœåŠ¡ï¼ˆçƒ­ç«¯+å†·ç«¯ï¼‰
- âœ… çŠ¶æ€æ£€æŸ¥å’Œå¥åº·æ£€æŸ¥
- âœ… æ—¥å¿—æŸ¥çœ‹å’Œæ¸…ç†

**ç«¯å£**:
- 8123: ClickHouse HTTP ç«¯å£
- 9000: ClickHouse Native ç«¯å£
- 8085: çƒ­ç«¯å­˜å‚¨æœåŠ¡ç«¯å£
- 8086: å†·ç«¯å­˜å‚¨æœåŠ¡ç«¯å£ï¼ˆå¯é€‰ï¼‰

---

### 3. Data Collector ç®¡ç†è„šæœ¬
**è·¯å¾„**: `services/data-collector/scripts/manage.sh`

**åŠŸèƒ½**:
- âœ… åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒ
- âœ… å®‰è£… Python ä¾èµ–ï¼ˆnats-py, websockets, ccxt, aiohttp, pydantic ç­‰ï¼‰
- âœ… åˆå§‹åŒ–é‡‡é›†å™¨é…ç½®
- âœ… å¯åŠ¨/åœæ­¢/é‡å¯æ•°æ®é‡‡é›†å™¨
- âœ… çŠ¶æ€æ£€æŸ¥å’Œå¥åº·æ£€æŸ¥
- âœ… æ—¥å¿—æŸ¥çœ‹å’Œæ¸…ç†

**ç«¯å£**:
- 8087: å¥åº·æ£€æŸ¥ç«¯å£
- 9093: Prometheus æŒ‡æ ‡ç«¯å£

---

## ğŸ¯ ç»Ÿä¸€æ¥å£

æ‰€æœ‰ä¸‰ä¸ªæ¨¡å—çš„ç®¡ç†è„šæœ¬éƒ½æ”¯æŒç›¸åŒçš„å‘½ä»¤æ¥å£ï¼š

```bash
./scripts/manage.sh [å‘½ä»¤]
```

### æ”¯æŒçš„å‘½ä»¤

| å‘½ä»¤ | åŠŸèƒ½ |
|------|------|
| `install-deps` | å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆç³»ç»Ÿä¾èµ– + Python ä¾èµ–ï¼‰ |
| `init` | åˆå§‹åŒ–æœåŠ¡ï¼ˆåˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€æ•°æ®åº“è¡¨ç­‰ï¼‰ |
| `start` | å¯åŠ¨æœåŠ¡ |
| `stop` | åœæ­¢æœåŠ¡ |
| `restart` | é‡å¯æœåŠ¡ |
| `status` | æ£€æŸ¥æœåŠ¡çŠ¶æ€ |
| `health` | æ‰§è¡Œå¥åº·æ£€æŸ¥ |
| `logs` | æŸ¥çœ‹æ—¥å¿—ï¼ˆå®æ—¶ï¼‰ |
| `clean` | æ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œé”æ–‡ä»¶ |
| `help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### å•æ¨¡å—éƒ¨ç½²

```bash
# éƒ¨ç½² Message Broker
cd services/message-broker
./scripts/manage.sh install-deps
./scripts/manage.sh init
./scripts/manage.sh start
./scripts/manage.sh status

# éƒ¨ç½² Data Storage Service
cd services/data-storage-service
./scripts/manage.sh install-deps
./scripts/manage.sh init
./scripts/manage.sh start
./scripts/manage.sh status

# éƒ¨ç½² Data Collector
cd services/data-collector
./scripts/manage.sh install-deps
./scripts/manage.sh init
./scripts/manage.sh start
./scripts/manage.sh status
```

### ä¸€é”®éƒ¨ç½²ï¼ˆæ‰€æœ‰æ¨¡å—ï¼‰

```bash
# æ–¹å¼ 1: ä½¿ç”¨å¾ªç¯
for module in message-broker data-storage-service data-collector; do
    cd services/$module
    ./scripts/manage.sh install-deps
    ./scripts/manage.sh init
    ./scripts/manage.sh start
    cd ../..
done

# æ–¹å¼ 2: ä½¿ç”¨ç»Ÿä¸€ç®¡ç†è„šæœ¬
./scripts/manage_all.sh init
./scripts/manage_all.sh start
```

---

## ğŸ“‹ è®¾è®¡ç‰¹ç‚¹

### 1. ç‹¬ç«‹æ€§
- âœ… æ¯ä¸ªæ¨¡å—çš„è„šæœ¬å®Œå…¨ç‹¬ç«‹
- âœ… ä¸ä¾èµ–å…¶ä»–æ¨¡å—çš„è„šæœ¬
- âœ… å¯ä»¥åœ¨ä¸åŒä¸»æœºä¸Šç‹¬ç«‹è¿è¡Œ

### 2. å¹‚ç­‰æ€§
- âœ… å¯ä»¥é‡å¤æ‰§è¡Œè€Œä¸å‡ºé”™
- âœ… è‡ªåŠ¨æ£€æµ‹å·²å®‰è£…çš„ç»„ä»¶
- âœ… æ™ºèƒ½è·³è¿‡ä¸å¿…è¦çš„æ­¥éª¤

### 3. è·¨å¹³å°
- âœ… æ”¯æŒ Ubuntu/Debian
- âœ… æ”¯æŒ CentOS/RHEL
- âœ… æ”¯æŒ macOS
- âœ… è‡ªåŠ¨æ£€æµ‹æ“ä½œç³»ç»Ÿå¹¶é€‚é…

### 4. é”™è¯¯å¤„ç†
- âœ… æ¯ä¸ªæ­¥éª¤éƒ½æœ‰é”™è¯¯æ£€æŸ¥
- âœ… æ¸…æ™°çš„é”™è¯¯æç¤º
- âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•

### 5. ç”¨æˆ·å‹å¥½
- âœ… å½©è‰²è¾“å‡ºï¼ˆç»¿è‰²=æˆåŠŸï¼Œé»„è‰²=è­¦å‘Šï¼Œçº¢è‰²=é”™è¯¯ï¼‰
- âœ… æ¸…æ™°çš„æ­¥éª¤æç¤º
- âœ… è¯¦ç»†çš„å¸®åŠ©ä¿¡æ¯

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
marketprism/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ message-broker/
â”‚   â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â”‚   â””â”€â”€ manage.sh          âœ… æ–°åˆ›å»º
â”‚   â”‚   â”œâ”€â”€ logs/                  âœ… è‡ªåŠ¨åˆ›å»º
â”‚   â”‚   â”‚   â”œâ”€â”€ nats-server.log
â”‚   â”‚   â”‚   â””â”€â”€ nats-server.pid
â”‚   â”‚   â””â”€â”€ venv/                  âœ… è‡ªåŠ¨åˆ›å»º
â”‚   â”‚
â”‚   â”œâ”€â”€ data-storage-service/
â”‚   â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â”‚   â””â”€â”€ manage.sh          âœ… æ–°åˆ›å»º
â”‚   â”‚   â”œâ”€â”€ logs/                  âœ… è‡ªåŠ¨åˆ›å»º
â”‚   â”‚   â”‚   â”œâ”€â”€ storage-hot.log
â”‚   â”‚   â”‚   â”œâ”€â”€ storage-hot.pid
â”‚   â”‚   â”‚   â””â”€â”€ clickhouse.log
â”‚   â”‚   â””â”€â”€ venv/                  âœ… è‡ªåŠ¨åˆ›å»º
â”‚   â”‚
â”‚   â””â”€â”€ data-collector/
â”‚       â”œâ”€â”€ scripts/
â”‚       â”‚   â””â”€â”€ manage.sh          âœ… æ–°åˆ›å»º
â”‚       â”œâ”€â”€ logs/                  âœ… è‡ªåŠ¨åˆ›å»º
â”‚       â”‚   â”œâ”€â”€ collector.log
â”‚       â”‚   â””â”€â”€ collector.pid
â”‚       â””â”€â”€ venv/                  âœ… è‡ªåŠ¨åˆ›å»º
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ test_module_scripts.sh     âœ… æ–°åˆ›å»ºï¼ˆæµ‹è¯•å·¥å…·ï¼‰
â”‚   â””â”€â”€ manage_all.sh              âœ… å·²å­˜åœ¨ï¼ˆç»Ÿä¸€ç®¡ç†ï¼‰
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ MODULE_DEPLOYMENT.md       âœ… æ–°åˆ›å»ºï¼ˆéƒ¨ç½²æŒ‡å—ï¼‰
    â””â”€â”€ MODULE_SCRIPTS_SUMMARY.md  âœ… æœ¬æ–‡æ¡£
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

å·²åˆ›å»ºæµ‹è¯•è„šæœ¬ `scripts/test_module_scripts.sh` æ¥éªŒè¯æ‰€æœ‰ç®¡ç†è„šæœ¬ï¼š

```bash
./scripts/test_module_scripts.sh
```

**æµ‹è¯•ç»“æœ**: âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

æµ‹è¯•å†…å®¹ï¼š
- âœ… è„šæœ¬æ–‡ä»¶å­˜åœ¨
- âœ… è„šæœ¬å¯æ‰§è¡Œ
- âœ… help å‘½ä»¤æ­£å¸¸
- âœ… æ‰€æœ‰å‘½ä»¤å·²å®šä¹‰

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

1. **æ¨¡å—éƒ¨ç½²æŒ‡å—**: `docs/MODULE_DEPLOYMENT.md`
   - è¯¦ç»†çš„éƒ¨ç½²æµç¨‹
   - å•æœºå’Œåˆ†å¸ƒå¼éƒ¨ç½²ç¤ºä¾‹
   - é…ç½®è¯´æ˜
   - æ•…éšœæ’æŸ¥

2. **å¿«é€Ÿå¼€å§‹**: `docs/QUICK_START.md`
   - 3åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²
   - å¸¸ç”¨å‘½ä»¤

3. **å®Œæ•´éƒ¨ç½²æ–‡æ¡£**: `docs/DEPLOYMENT.md`
   - ç³»ç»Ÿè¦æ±‚
   - è¯¦ç»†æ­¥éª¤
   - é…ç½®è¯´æ˜

---

## ğŸ‰ ä¼˜åŠ¿æ€»ç»“

### å¯¹æ¯”ä¹‹å‰çš„éƒ¨ç½²æ–¹å¼

| ç‰¹æ€§ | ä¹‹å‰ | ç°åœ¨ |
|------|------|------|
| **æ¨¡å—ç‹¬ç«‹æ€§** | ä¾èµ–ç»Ÿä¸€è„šæœ¬ | å®Œå…¨ç‹¬ç«‹ âœ… |
| **åˆ†å¸ƒå¼éƒ¨ç½²** | å›°éš¾ | ç®€å• âœ… |
| **ä¾èµ–ç®¡ç†** | æ‰‹åŠ¨å®‰è£… | è‡ªåŠ¨å®‰è£… âœ… |
| **è™šæ‹Ÿç¯å¢ƒ** | å…±äº« | ç‹¬ç«‹ âœ… |
| **é…ç½®ç®¡ç†** | é›†ä¸­ | æ¨¡å—åŒ– âœ… |
| **é”™è¯¯éš”ç¦»** | ç›¸äº’å½±å“ | ç‹¬ç«‹éš”ç¦» âœ… |
| **ç»´æŠ¤æˆæœ¬** | é«˜ | ä½ âœ… |

### å®é™…åº”ç”¨åœºæ™¯

1. **å¼€å‘ç¯å¢ƒ**: åœ¨æœ¬åœ°æœºå™¨ä¸Šå¿«é€Ÿæ­å»ºå®Œæ•´ç³»ç»Ÿ
2. **æµ‹è¯•ç¯å¢ƒ**: åœ¨æµ‹è¯•æœåŠ¡å™¨ä¸Šç‹¬ç«‹éƒ¨ç½²å’Œæµ‹è¯•æ¯ä¸ªæ¨¡å—
3. **ç”Ÿäº§ç¯å¢ƒ**: åœ¨ä¸åŒç‰©ç†ä¸»æœºä¸Šåˆ†å¸ƒå¼éƒ¨ç½²
4. **å®¹å™¨åŒ–**: æ¯ä¸ªæ¨¡å—å¯ä»¥ç‹¬ç«‹æ‰“åŒ…æˆ Docker é•œåƒ
5. **å¾®æœåŠ¡**: æ”¯æŒ Kubernetes ç­‰å®¹å™¨ç¼–æ’å¹³å°

---

## ğŸ”„ ä¸‹ä¸€æ­¥

### çŸ­æœŸï¼ˆå·²å®Œæˆï¼‰
- âœ… åˆ›å»ºä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—çš„ç‹¬ç«‹ç®¡ç†è„šæœ¬
- âœ… ç»Ÿä¸€å‘½ä»¤æ¥å£
- âœ… åˆ›å»ºæµ‹è¯•å·¥å…·
- âœ… ç¼–å†™è¯¦ç»†æ–‡æ¡£

### ä¸­æœŸï¼ˆå»ºè®®ï¼‰
- [ ] æ·»åŠ  Docker æ”¯æŒï¼ˆä¸ºæ¯ä¸ªæ¨¡å—åˆ›å»º Dockerfileï¼‰
- [ ] æ·»åŠ  Docker Compose é…ç½®
- [ ] æ·»åŠ é…ç½®æ–‡ä»¶æ¨¡æ¿å’ŒéªŒè¯
- [ ] æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•

### é•¿æœŸï¼ˆå»ºè®®ï¼‰
- [ ] Kubernetes éƒ¨ç½²æ”¯æŒï¼ˆHelm Chartsï¼‰
- [ ] CI/CD é›†æˆ
- [ ] ç›‘æ§å’Œå‘Šè­¦é›†æˆ
- [ ] è‡ªåŠ¨æ‰©ç¼©å®¹æ”¯æŒ

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. **åˆ†å¸ƒå¼éƒ¨ç½²**:
   ```
   ä¸»æœº 1: Message Broker (NATS)
   ä¸»æœº 2: Data Storage Service (ClickHouse)
   ä¸»æœº 3: Data Collector (é‡‡é›†å™¨)
   ```

2. **é«˜å¯ç”¨éƒ¨ç½²**:
   ```
   ä¸»æœº 1-3: NATS é›†ç¾¤
   ä¸»æœº 4-6: ClickHouse é›†ç¾¤
   ä¸»æœº 7-9: Data Collector é›†ç¾¤
   ```

3. **å®¹å™¨åŒ–éƒ¨ç½²**:
   ```
   æ¯ä¸ªæ¨¡å—ç‹¬ç«‹æ‰“åŒ…æˆ Docker é•œåƒ
   ä½¿ç”¨ Kubernetes è¿›è¡Œç¼–æ’å’Œç®¡ç†
   ```

### æ—¥å¸¸ç»´æŠ¤

```bash
# æ¯æ—¥å¥åº·æ£€æŸ¥
for module in message-broker data-storage-service data-collector; do
    cd services/$module
    ./scripts/manage.sh health
    cd ../..
done

# æŸ¥çœ‹æ—¥å¿—
./scripts/manage.sh logs

# é‡å¯æœåŠ¡
./scripts/manage.sh restart
```

---

## ğŸ“ è·å–å¸®åŠ©

- **æŸ¥çœ‹å¸®åŠ©**: `./scripts/manage.sh help`
- **æŸ¥çœ‹æ–‡æ¡£**: `cat docs/MODULE_DEPLOYMENT.md`
- **è¿è¡Œæµ‹è¯•**: `./scripts/test_module_scripts.sh`
- **GitHub Issues**: https://github.com/MNS-Vic/marketprism/issues

---

**åˆ›å»ºæ—¶é—´**: 2025-09-30  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

