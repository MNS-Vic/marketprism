# MarketPrism 数据结构定义

## 📋 概述
本文档定义了MarketPrism系统中所有API接口使用的数据结构，确保前后端数据交互的一致性。

## 🏗️ 基础数据类型

### 通用响应结构
```typescript
interface ApiResponse<T> {
  status: 'success' | 'error';
  data?: T;
  error?: {
    code: number;
    message: string;
    details?: string;
  };
  timestamp: number;
}
```

### 分页数据结构
```typescript
interface PaginatedResponse<T> {
  items: T[];
  total: number;
  page: number;
  size: number;
  hasNext: boolean;
  hasPrev: boolean;
}
```

## 🖥️ 系统监控数据结构

### 系统概览数据
```typescript
interface SystemOverview {
  cpu_usage: number;        // CPU使用率 (%)
  memory_usage: number;     // 内存使用率 (%)
  disk_usage: number;       // 磁盘使用率 (%)
  network_in: number;       // 网络入流量 (KB/s)
  network_out: number;      // 网络出流量 (KB/s)
  system_load: number;      // 系统负载
  uptime: number;           // 运行时间 (秒)
  timestamp: number;        // 时间戳
}
```

### 服务状态数据
```typescript
interface ServiceStatus {
  name: string;             // 服务名称
  status: 'running' | 'stopped' | 'error' | 'maintenance';
  port: number;             // 服务端口
  response_time: number;    // 响应时间 (ms)
  cpu_usage: number;        // CPU使用率 (%)
  memory_usage: number;     // 内存使用 (MB)
  health_score: number;     // 健康评分 (0-100)
  uptime: number;           // 运行时间 (秒)
  last_restart: number;     // 最后重启时间
  error_count: number;      // 错误计数
}
```

### 服务列表数据
```typescript
interface ServicesData {
  services: {
    [serviceName: string]: ServiceStatus;
  };
  summary: {
    total: number;
    running: number;
    stopped: number;
    error: number;
  };
}
```

### 告警数据
```typescript
interface Alert {
  id: string;
  level: 'info' | 'warning' | 'error' | 'critical';
  title: string;
  message: string;
  service: string;
  timestamp: number;
  acknowledged: boolean;
  resolved: boolean;
}

interface AlertsData {
  active: Alert[];
  recent: Alert[];
  summary: {
    total: number;
    critical: number;
    error: number;
    warning: number;
    info: number;
  };
}
```

## 📊 交易数据结构

### 交易所连接状态
```typescript
interface ExchangeStatus {
  name: string;             // 交易所名称
  status: 'connected' | 'disconnected' | 'error' | 'maintenance';
  latency: number;          // 延迟 (ms)
  pairs_count: number;      // 交易对数量
  update_rate: number;      // 更新频率 (次/分钟)
  last_update: number;      // 最后更新时间
  api_limits: {
    used: number;
    total: number;
    reset_time: number;
  };
}
```

### 交易所数据汇总
```typescript
interface ExchangesData {
  exchanges: {
    [exchangeName: string]: ExchangeStatus;
  };
  summary: {
    total: number;
    connected: number;
    total_pairs: number;
    avg_latency: number;
  };
}
```

### 价格数据
```typescript
interface PriceData {
  symbol: string;           // 交易对符号
  exchange: string;         // 交易所名称
  price: number;            // 当前价格
  change_24h: number;       // 24小时涨跌幅 (%)
  volume_24h: number;       // 24小时交易量
  high_24h: number;         // 24小时最高价
  low_24h: number;          // 24小时最低价
  open_24h: number;         // 24小时开盘价
  timestamp: number;        // 时间戳
}
```

### 订单簿数据
```typescript
interface OrderBookEntry {
  price: number;            // 价格
  amount: number;           // 数量
  total: number;            // 累计金额
}

interface OrderBook {
  symbol: string;           // 交易对
  exchange: string;         // 交易所
  asks: OrderBookEntry[];   // 卖单
  bids: OrderBookEntry[];   // 买单
  timestamp: number;        // 时间戳
  sequence: number;         // 序列号
}
```

### 交易记录
```typescript
interface TradeRecord {
  id: string;               // 交易ID
  symbol: string;           // 交易对
  exchange: string;         // 交易所
  side: 'buy' | 'sell';     // 买卖方向
  price: number;            // 成交价格
  amount: number;           // 成交数量
  value: number;            // 成交金额
  timestamp: number;        // 成交时间
  fee?: number;             // 手续费
}
```

### K线数据
```typescript
interface KlineData {
  symbol: string;           // 交易对
  exchange: string;         // 交易所
  interval: string;         // 时间间隔 (1m, 5m, 1h, 1d, etc.)
  open_time: number;        // 开盘时间
  close_time: number;       // 收盘时间
  open: number;             // 开盘价
  high: number;             // 最高价
  low: number;              // 最低价
  close: number;            // 收盘价
  volume: number;           // 交易量
  trade_count: number;      // 交易次数
}
```

## 📈 图表数据结构

### 时序数据点
```typescript
interface TimeSeriesPoint {
  timestamp: number;        // 时间戳
  value: number;            // 数值
  label?: string;           // 标签
}

interface TimeSeriesData {
  name: string;             // 系列名称
  color?: string;           // 颜色
  data: TimeSeriesPoint[];  // 数据点
}
```

### 图表配置
```typescript
interface ChartConfig {
  type: 'line' | 'area' | 'bar' | 'candlestick';
  title: string;
  subtitle?: string;
  xAxis: {
    type: 'time' | 'category';
    label: string;
  };
  yAxis: {
    label: string;
    unit?: string;
    min?: number;
    max?: number;
  };
  series: TimeSeriesData[];
  options?: {
    animation?: boolean;
    zoom?: boolean;
    grid?: boolean;
    tooltip?: boolean;
  };
}
```

## 🔌 WebSocket 数据结构

### WebSocket 消息基础结构
```typescript
interface WebSocketMessage {
  type: 'subscribe' | 'unsubscribe' | 'data' | 'error' | 'ping' | 'pong';
  channel: string;
  data?: any;
  timestamp?: number;
}
```

### 订阅请求
```typescript
interface SubscribeRequest {
  type: 'subscribe';
  channel: 'prices' | 'orderbook' | 'trades' | 'system' | 'alerts';
  symbol?: string;          // 交易对 (价格、订单簿、交易数据需要)
  exchange?: string;        // 交易所
  interval?: string;        // 时间间隔 (K线数据)
}
```

### 实时价格推送
```typescript
interface PriceUpdate {
  type: 'data';
  channel: 'prices';
  data: {
    symbol: string;
    exchange: string;
    price: number;
    change: number;
    volume: number;
    timestamp: number;
  };
}
```

### 实时订单簿推送
```typescript
interface OrderBookUpdate {
  type: 'data';
  channel: 'orderbook';
  data: {
    symbol: string;
    exchange: string;
    asks: OrderBookEntry[];
    bids: OrderBookEntry[];
    timestamp: number;
  };
}
```

## 🔐 认证数据结构

### API密钥
```typescript
interface ApiCredentials {
  api_key: string;
  api_secret?: string;      // 如果需要签名
  passphrase?: string;      // 某些交易所需要
  permissions: string[];    // 权限列表
  expires_at?: number;      // 过期时间
}
```

### 用户信息
```typescript
interface UserInfo {
  id: string;
  username: string;
  email: string;
  role: 'admin' | 'user' | 'readonly';
  permissions: string[];
  created_at: number;
  last_login: number;
}
```

## ❌ 错误数据结构

### 错误响应
```typescript
interface ErrorResponse {
  status: 'error';
  error: {
    code: number;           // 错误码
    message: string;        // 错误消息
    details?: string;       // 详细信息
    field?: string;         // 错误字段 (表单验证错误)
    trace_id?: string;      // 追踪ID (用于调试)
  };
  timestamp: number;
}
```

### 常用错误码
```typescript
enum ErrorCode {
  UNAUTHORIZED = 401,
  FORBIDDEN = 403,
  NOT_FOUND = 404,
  VALIDATION_ERROR = 422,
  RATE_LIMITED = 429,
  INTERNAL_ERROR = 500,
  SERVICE_UNAVAILABLE = 503
}
```

## 🎨 UI组件数据结构

### 仪表板卡片
```typescript
interface DashboardCard {
  id: string;
  title: string;
  subtitle?: string;
  value: number | string;
  unit?: string;
  change?: number;          // 变化值
  change_type?: 'increase' | 'decrease' | 'neutral';
  status?: 'success' | 'warning' | 'error';
  icon?: string;
  color?: string;
  chart_data?: TimeSeriesPoint[];
}
```

### 状态指示器
```typescript
interface StatusIndicator {
  status: 'online' | 'offline' | 'warning' | 'error';
  label: string;
  description?: string;
  color: string;
  pulse?: boolean;          // 是否闪烁
}
```

### 数据表格列定义
```typescript
interface TableColumn {
  key: string;
  title: string;
  dataIndex: string;
  width?: number;
  align?: 'left' | 'center' | 'right';
  sortable?: boolean;
  filterable?: boolean;
  render?: (value: any, record: any) => React.ReactNode;
}
```

## 📱 移动端适配数据

### 响应式断点
```typescript
interface BreakPoints {
  xs: number;   // 超小屏 < 576px
  sm: number;   // 小屏 576px - 768px
  md: number;   // 中屏 768px - 992px
  lg: number;   // 大屏 992px - 1200px
  xl: number;   // 超大屏 > 1200px
}
```

### 移动端配置
```typescript
interface MobileConfig {
  simplified_layout: boolean;    // 简化布局
  touch_optimized: boolean;      // 触摸优化
  reduced_animations: boolean;   // 减少动画
  data_compression: boolean;     // 数据压缩
}
```

这些数据结构定义了MarketPrism系统的完整数据模型，前端团队可以基于这些定义进行TypeScript类型声明和接口对接。