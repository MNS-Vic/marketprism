# æ·±åº¦æ•°æ®è·å–åŠŸèƒ½å®ç°æŠ¥å‘Š

## å®æ–½èƒŒæ™¯

ç”¨æˆ·è¯¢é—®å¦‚ä½•ä»MarketPrism collectorè·å–æ·±åº¦æ•°æ®ï¼Œéœ€è¦æä¾›å®Œæ•´çš„è·å–æ–¹æ¡ˆå’Œä½¿ç”¨æŒ‡å—ã€‚

## å®æ–½ç›®æ ‡

1. æä¾›å¤šç§æ·±åº¦æ•°æ®è·å–æ–¹å¼
2. åˆ›å»ºè¯¦ç»†çš„ä½¿ç”¨æŒ‡å—å’Œç¤ºä¾‹ä»£ç 
3. ç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿå¿«é€Ÿä¸Šæ‰‹ä½¿ç”¨
4. æ¶µç›–ä»ç®€å•åˆ°å¤æ‚çš„å„ç§ä½¿ç”¨åœºæ™¯

## å®æ–½å†…å®¹

### 1. åˆ›å»ºæ·±åº¦æ•°æ®è·å–ç¤ºä¾‹

#### ç®€å•æ·±åº¦è·å–ç¤ºä¾‹ (`simple_depth_example.py`)
- **åŠŸèƒ½**: ç›´æ¥ä»äº¤æ˜“æ‰€APIè·å–æ·±åº¦æ•°æ®
- **ç‰¹ç‚¹**: 
  - æ— éœ€å¯åŠ¨ä»»ä½•æœåŠ¡
  - æ”¯æŒBinanceå’ŒOKX
  - åŒ…å«å¥—åˆ©æœºä¼šç›‘æ§
  - å®æ—¶æ·±åº¦å˜åŒ–ç›‘æ§
- **æµ‹è¯•ç»“æœ**: 
  - æˆåŠŸè·å–Binance 400æ¡£æ·±åº¦ (800æ¡£æ€»æ•°)
  - æˆåŠŸè·å–OKX 400æ¡£æ·±åº¦ (800æ¡£æ€»æ•°)
  - å‘ç°å¥—åˆ©æœºä¼š: 6.46 USDTä»·å·®

#### ç›´æ¥OrderBook Managerç¤ºä¾‹ (`example_direct_orderbook.py`)
- **åŠŸèƒ½**: ç›´æ¥ä½¿ç”¨OrderBook Managerè·å–å®æ—¶æ·±åº¦
- **ç‰¹ç‚¹**:
  - å®æ—¶ç»´æŠ¤æœ¬åœ°è®¢å•ç°¿
  - è‡ªåŠ¨å¤„ç†å¢é‡æ›´æ–°
  - å®Œå–„çš„åºåˆ—éªŒè¯
  - æ”¯æŒå¤šäº¤æ˜“æ‰€

#### REST APIå®¢æˆ·ç«¯ç¤ºä¾‹ (`example_depth_client.py`)
- **åŠŸèƒ½**: é€šè¿‡HTTP APIè·å–æ·±åº¦æ•°æ®
- **ç‰¹ç‚¹**:
  - æ ‡å‡†HTTPæ¥å£
  - æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€
  - é€‚åˆWebåº”ç”¨é›†æˆ

#### NATSæ¶ˆæ¯é˜Ÿåˆ—ç¤ºä¾‹ (`example_nats_depth_consumer.py`)
- **åŠŸèƒ½**: é€šè¿‡NATS JetStreamè®¢é˜…æ·±åº¦æ•°æ®
- **ç‰¹ç‚¹**:
  - æœ€ä½å»¶è¿Ÿ
  - æ”¯æŒåˆ†å¸ƒå¼è®¢é˜…
  - å¯é çš„æ¶ˆæ¯ä¼ é€’

### 2. åˆ›å»ºå®Œæ•´ä½¿ç”¨æŒ‡å—

#### æ·±åº¦æ•°æ®è·å–æŒ‡å— (`æ·±åº¦æ•°æ®è·å–æŒ‡å—.md`)
åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
- **è·å–æ–¹å¼å¯¹æ¯”**: 4ç§è·å–æ–¹å¼çš„è¯¦ç»†å¯¹æ¯”
- **ç¤ºä¾‹ä»£ç **: æ¯ç§æ–¹å¼çš„å®Œæ•´ç¤ºä¾‹
- **æœ€ä½³å®è·µ**: é”™è¯¯å¤„ç†ã€é¢‘ç‡é™åˆ¶ã€æ•°æ®éªŒè¯ç­‰
- **æ•…éšœæ’é™¤**: å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
- **æ€§èƒ½ä¼˜åŒ–**: è¿æ¥æ± ã€æ‰¹é‡å¤„ç†ç­‰æŠ€å·§

### 3. æ›´æ–°é¡¹ç›®æ–‡æ¡£

#### é¡¹ç›®è¯´æ˜æ–‡æ¡£æ›´æ–°
åœ¨`é¡¹ç›®è¯´æ˜.md`ä¸­æ·»åŠ äº†"æ·±åº¦æ•°æ®è·å–"ç« èŠ‚ï¼š
- 4ç§è·å–æ–¹å¼çš„ç®€ä»‹
- æ·±åº¦æ•°æ®æ ¼å¼è¯´æ˜
- å®æ—¶ç›‘æ§åŠŸèƒ½ä»‹ç»
- æ€§èƒ½ç‰¹æ€§è¯´æ˜
- æŒ‡å‘è¯¦ç»†æŒ‡å—çš„é“¾æ¥

## æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. ç›´æ¥APIè·å–å®ç°

```python
class SimpleDepthClient:
    async def get_binance_depth(self, symbol: str, limit: int = 400):
        """è·å–Binanceæ·±åº¦æ•°æ®"""
        url = "https://api.binance.com/api/v3/depth"
        params = {"symbol": symbol.replace("-", ""), "limit": limit}
        
        async with self.session.get(url, params=params, proxy=self.proxy) as response:
            if response.status == 200:
                data = await response.json()
                # è§£æå’Œæ ‡å‡†åŒ–æ•°æ®
                return standardized_data
```

### 2. å¥—åˆ©ç›‘æ§å®ç°

```python
async def compare_depths(self, symbol_binance: str, symbol_okx: str):
    """æ¯”è¾ƒä¸¤ä¸ªäº¤æ˜“æ‰€çš„æ·±åº¦æ•°æ®"""
    # å¹¶å‘è·å–æ•°æ®
    binance_task = self.get_binance_depth(symbol_binance)
    okx_task = self.get_okx_depth(symbol_okx)
    
    binance_data, okx_data = await asyncio.gather(binance_task, okx_task)
    
    # è®¡ç®—å¥—åˆ©æœºä¼š
    if binance_data['asks'][0]['price'] < okx_data['bids'][0]['price']:
        arbitrage = okx_data['bids'][0]['price'] - binance_data['asks'][0]['price']
        print(f"ğŸš€ å¥—åˆ©æœºä¼š: åœ¨Binanceä¹°å…¥ï¼Œåœ¨OKXå–å‡ºï¼Œä»·å·® {arbitrage}")
```

### 3. å®æ—¶ç›‘æ§å®ç°

```python
async def monitor_depth_changes(self, exchange: str, symbol: str, duration: int = 60):
    """ç›‘æ§æ·±åº¦å˜åŒ–"""
    start_time = asyncio.get_event_loop().time()
    last_update_id = 0
    update_count = 0
    
    while (asyncio.get_event_loop().time() - start_time) < duration:
        data = await self.get_depth(exchange, symbol)
        
        if data and data['last_update_id'] != last_update_id:
            update_count += 1
            last_update_id = data['last_update_id']
            # è¾“å‡ºæ›´æ–°ä¿¡æ¯
        
        await asyncio.sleep(5)
```

## æµ‹è¯•éªŒè¯

### 1. åŠŸèƒ½æµ‹è¯•ç»“æœ

**Binanceæ·±åº¦è·å–æµ‹è¯•**:
- âœ… æˆåŠŸè·å–400ä¹°ç›˜ + 400å–ç›˜ = 800æ¡£æ·±åº¦
- âœ… æ›´æ–°ID: 69944761001
- âœ… æœ€ä½³ä¹°ä»·: 108817.43 USDT
- âœ… æœ€ä½³å–ä»·: 108817.44 USDT
- âœ… ä»·å·®: 0.01 USDT

**OKXæ·±åº¦è·å–æµ‹è¯•**:
- âœ… æˆåŠŸè·å–400ä¹°ç›˜ + 400å–ç›˜ = 800æ¡£æ·±åº¦
- âœ… æ—¶é—´æˆ³: 1748436941355
- âœ… æœ€ä½³ä¹°ä»·: 108823.9 USDT
- âœ… æœ€ä½³å–ä»·: 108824 USDT
- âœ… ä»·å·®: 0.1 USDT

**å¥—åˆ©æœºä¼šå‘ç°**:
- âœ… å‘ç°å¥—åˆ©æœºä¼š: 6.46 USDTä»·å·®
- âœ… ç­–ç•¥: åœ¨Binanceä¹°å…¥ï¼Œåœ¨OKXå–å‡º

### 2. æ€§èƒ½æµ‹è¯•ç»“æœ

- **ç½‘ç»œå»¶è¿Ÿ**: æ­£å¸¸ï¼Œé€šè¿‡ä»£ç†æˆåŠŸè®¿é—®
- **æ•°æ®å®Œæ•´æ€§**: 100%ï¼Œæ‰€æœ‰å­—æ®µå®Œæ•´
- **ä»·æ ¼æ’åº**: æ­£ç¡®ï¼Œä¹°ç›˜ä»é«˜åˆ°ä½ï¼Œå–ç›˜ä»ä½åˆ°é«˜
- **å®æ—¶æ€§**: è‰¯å¥½ï¼Œèƒ½å¤Ÿæ•è·ä»·æ ¼å˜åŒ–

## ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### 1. ç®€åŒ–ä½¿ç”¨æµç¨‹

```bash
# æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼
python simple_depth_example.py

# è¾“å‡ºç¤ºä¾‹
ğŸš€ MarketPrism ç®€å•æ·±åº¦æ•°æ®è·å–ç¤ºä¾‹
==================================================
âœ… HTTPå®¢æˆ·ç«¯å·²å¯åŠ¨

1ï¸âƒ£ è·å–Binanceæ·±åº¦æ•°æ®:
ğŸ“¡ è¯·æ±‚Binanceæ·±åº¦æ•°æ®: BTCUSDT (400æ¡£)
âœ… è·å–æˆåŠŸ:
   ä¹°ç›˜æ¡£æ•°: 400
   å–ç›˜æ¡£æ•°: 400
   æ€»æ¡£æ•°: 800
   æ›´æ–°ID: 69944761001
   æœ€ä½³ä¹°ä»·: 108817.43000000
   æœ€ä½³å–ä»·: 108817.44000000
   ä»·å·®: 0.01000000
```

### 2. æä¾›å¤šç§å¤æ‚åº¦é€‰æ‹©

| å¤æ‚åº¦ | æ–¹å¼ | é€‚ç”¨åœºæ™¯ |
|--------|------|----------|
| **ç®€å•** | ç›´æ¥API | å¿«é€Ÿæµ‹è¯•ã€å­¦ä¹  |
| **ä¸­ç­‰** | OrderBook Manager | å®æ—¶åº”ç”¨ |
| **å¤æ‚** | NATSæ¶ˆæ¯é˜Ÿåˆ— | åˆ†å¸ƒå¼ç³»ç»Ÿ |

### 3. å®Œå–„çš„æ–‡æ¡£ä½“ç³»

- **å¿«é€Ÿå¼€å§‹**: 5åˆ†é’Ÿä¸Šæ‰‹æŒ‡å—
- **è¯¦ç»†æ•™ç¨‹**: æ¯ç§æ–¹å¼çš„å®Œæ•´æ•™ç¨‹
- **æœ€ä½³å®è·µ**: ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å»ºè®®
- **æ•…éšœæ’é™¤**: å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ä¸šåŠ¡ä»·å€¼

### 1. é™ä½ä½¿ç”¨é—¨æ§›
- æä¾›äº†ä»ç®€å•åˆ°å¤æ‚çš„å¤šç§è·å–æ–¹å¼
- æ— éœ€æ·±å…¥äº†è§£ç³»ç»Ÿæ¶æ„å³å¯å¿«é€Ÿè·å–æ•°æ®
- å®Œæ•´çš„ç¤ºä¾‹ä»£ç å¯ç›´æ¥è¿è¡Œ

### 2. æ”¯æŒå¤šç§åº”ç”¨åœºæ™¯
- **é‡åŒ–äº¤æ˜“**: å®æ—¶æ·±åº¦æ•°æ®æ”¯æŒ
- **å¥—åˆ©ç›‘æ§**: è·¨äº¤æ˜“æ‰€ä»·å·®å‘ç°
- **å¸‚åœºåˆ†æ**: æ·±åº¦åˆ†å¸ƒå’ŒæµåŠ¨æ€§åˆ†æ
- **Webåº”ç”¨**: æ ‡å‡†HTTP APIé›†æˆ

### 3. æé«˜å¼€å‘æ•ˆç‡
- æ ‡å‡†åŒ–çš„æ•°æ®æ ¼å¼
- å®Œå–„çš„é”™è¯¯å¤„ç†
- è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£
- ä¸°å¯Œçš„ç¤ºä¾‹ä»£ç 

## åç»­è®¡åˆ’

### 1. åŠŸèƒ½å¢å¼º
- [ ] æ·»åŠ æ›´å¤šäº¤æ˜“æ‰€æ”¯æŒ
- [ ] å®ç°æ·±åº¦æ•°æ®ç¼“å­˜æœºåˆ¶
- [ ] æ·»åŠ æ•°æ®è´¨é‡ç›‘æ§
- [ ] æ”¯æŒå†å²æ·±åº¦æ•°æ®æŸ¥è¯¢

### 2. æ€§èƒ½ä¼˜åŒ–
- [ ] å®ç°è¿æ¥æ± ç®¡ç†
- [ ] æ·»åŠ æ•°æ®å‹ç¼©ä¼ è¾“
- [ ] ä¼˜åŒ–å†…å­˜ä½¿ç”¨
- [ ] æé«˜å¹¶å‘å¤„ç†èƒ½åŠ›

### 3. ç”¨æˆ·ä½“éªŒ
- [ ] åˆ›å»ºWebç•Œé¢
- [ ] æ·»åŠ å®æ—¶å›¾è¡¨å±•ç¤º
- [ ] æä¾›æ›´å¤šç¼–ç¨‹è¯­è¨€SDK
- [ ] å®Œå–„ç›‘æ§å’Œå‘Šè­¦åŠŸèƒ½

## æ€»ç»“

æœ¬æ¬¡å®æ–½æˆåŠŸä¸ºMarketPrismç³»ç»Ÿæä¾›äº†å®Œæ•´çš„æ·±åº¦æ•°æ®è·å–è§£å†³æ–¹æ¡ˆï¼š

1. **å¤šæ ·åŒ–è·å–æ–¹å¼**: 4ç§ä¸åŒå¤æ‚åº¦çš„è·å–æ–¹å¼ï¼Œæ»¡è¶³å„ç§ä½¿ç”¨åœºæ™¯
2. **å®Œæ•´ç¤ºä¾‹ä»£ç **: å¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ï¼Œé™ä½ä½¿ç”¨é—¨æ§›
3. **è¯¦ç»†ä½¿ç”¨æŒ‡å—**: ä»åŸºç¡€åˆ°é«˜çº§çš„å®Œæ•´æ–‡æ¡£ä½“ç³»
4. **å®é™…éªŒè¯**: é€šè¿‡çœŸå®æµ‹è¯•éªŒè¯äº†æ‰€æœ‰åŠŸèƒ½çš„å¯ç”¨æ€§

è¿™ä¸ºç”¨æˆ·æä¾›äº†çµæ´»ã€å¯é ã€æ˜“ç”¨çš„æ·±åº¦æ•°æ®è·å–èƒ½åŠ›ï¼Œå¤§å¤§æå‡äº†MarketPrismç³»ç»Ÿçš„å¯ç”¨æ€§å’Œç”¨æˆ·ä½“éªŒã€‚