# MarketPrism 架构守护清单

## 🛡️ 架构守护者职责

> 确保 MarketPrism 项目架构的一致性和可维护性

## 📋 日常检查清单

### 🔍 新功能开发检查

#### 1. 架构设计审查
- [ ] **功能边界明确**: 新功能的职责是否清晰？
- [ ] **重复实现检查**: 是否与现有功能重复？
- [ ] **服务职责**: 是否符合单一职责原则？
- [ ] **依赖关系**: 是否引入不必要的依赖？

#### 2. 实现方案审查
- [ ] **数据模型**: 是否使用统一的 Pydantic 模型？
- [ ] **目录结构**: 是否遵循推荐的目录结构？
- [ ] **配置管理**: 是否集中在 `config/` 目录？
- [ ] **导入路径**: 是否从权威模块导入？

#### 3. 代码质量检查
- [ ] **重复代码**: 是否存在重复的逻辑？
- [ ] **接口设计**: 是否使用抽象基类？
- [ ] **错误处理**: 是否有完善的异常处理？
- [ ] **测试覆盖**: 是否有对应的测试？

### 🚫 严格禁止事项检查

#### 数据标准化
- [ ] **禁止**: 在 `python-collector` 外创建新的标准化实现
- [ ] **禁止**: 复制现有的标准化逻辑
- [ ] **禁止**: 修改标准化接口而不更新所有调用方

#### 数据模型
- [ ] **禁止**: 创建新的 dataclass 模型（必须用 Pydantic）
- [ ] **禁止**: 重复定义相同的数据结构
- [ ] **禁止**: 在多个地方定义相同的枚举

#### 服务架构
- [ ] **禁止**: 创建功能重复的新服务
- [ ] **禁止**: 在服务间复制相同的逻辑
- [ ] **禁止**: 未经审查就添加新的依赖

#### 配置管理
- [ ] **禁止**: 在服务目录下创建独立配置
- [ ] **禁止**: 硬编码配置值
- [ ] **禁止**: 重复定义相同的配置项

## 🔧 自动化检查工具

### 重复代码检测
```bash
# 检测重复的类定义
grep -r "class.*Normalizer" services/ | wc -l
# 期望结果: 1 (只在 python-collector 中)

# 检测重复的数据模型
grep -r "class.*Trade" services/ src/ | grep -v "__pycache__"
# 期望结果: 只在 types.py 中有定义

# 检测重复的配置文件
find . -name "config.py" -o -name "config.yaml" | grep -v __pycache__
# 期望结果: 只在 config/ 目录下
```

### 导入检查
```bash
# 检查是否有从废弃模块导入
grep -r "from src.marketprism" services/
# 期望结果: 无结果

# 检查是否有从重复模块导入
grep -r "from.*data_normalizer" services/
# 期望结果: 无结果
```

### 架构一致性检查
```bash
# 检查服务目录结构
ls services/
# 期望结果: python-collector, reliability, data_archiver, ingestion

# 检查是否有未授权的新服务
find services/ -maxdepth 1 -type d | wc -l
# 期望结果: 5 (包括 services 目录本身)
```

## 📊 定期审查计划

### 每周检查 (周五)
- [ ] 运行自动化检查工具
- [ ] 审查本周的所有 PR
- [ ] 检查是否有新的重复代码
- [ ] 验证架构文档是否更新

### 每月审查 (月末)
- [ ] 全面的架构一致性检查
- [ ] 重复代码深度扫描
- [ ] 服务边界重新评估
- [ ] 性能指标审查

### 每季度评估 (季末)
- [ ] 架构演进规划
- [ ] 技术债务评估
- [ ] 重构计划制定
- [ ] 开发规范更新

## ⚠️ 违规处理流程

### 发现重复实现
1. **立即标记**: 在 PR 中标记问题
2. **停止合并**: 阻止违规代码合并
3. **制定计划**: 与开发者讨论重构方案
4. **跟踪修复**: 确保问题得到解决

### 架构违规
1. **代码回滚**: 严重违规立即回滚
2. **团队讨论**: 组织架构讨论会议
3. **规范更新**: 更新开发规范
4. **培训强化**: 加强团队培训

## 🎯 关键指标监控

### 代码质量指标
- **重复代码率**: < 5%
- **循环依赖**: 0 个
- **未使用模块**: 0 个
- **配置分散度**: 集中在 config/

### 架构健康度
- **服务职责清晰度**: 100%
- **接口一致性**: 100%
- **文档同步率**: 100%
- **测试覆盖率**: > 90%

## 📚 参考资料

### 必读文档
- [开发规范](开发规范.md)
- [架构分析报告](../docs/架构分析报告.md)
- [架构优化建议](../docs/架构优化建议.md)

### 检查工具
- `grep` - 文本搜索
- `find` - 文件查找
- `pytest` - 测试运行
- `flake8` - 代码风格检查

## 🏆 架构守护者权限

### 审查权限
- **PR 审查**: 必须审查所有架构相关的 PR
- **设计决策**: 参与重要的架构设计决策
- **规范制定**: 制定和更新开发规范

### 执行权限
- **阻止合并**: 可以阻止违反架构原则的代码合并
- **要求重构**: 可以要求重构不符合规范的代码
- **规范执行**: 确保开发规范的严格执行

---

## 🎖️ 守护者宣言

> 作为 MarketPrism 的架构守护者，我承诺：
> 
> 1. **坚持原则**: 严格遵循架构原则，不妥协
> 2. **预防为主**: 在问题发生前就进行预防
> 3. **持续改进**: 不断优化架构和流程
> 4. **团队协作**: 与团队成员密切合作，共同维护架构
> 
> **目标**: 让 MarketPrism 成为架构清晰、代码优雅的企业级系统！ 