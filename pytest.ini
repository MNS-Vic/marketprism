[pytest]
minversion = 6.0
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

addopts =
    --tb=short
    --strict-config
    --cov=core
    --cov=services
    --cov-report=term-missing
    --cov-report=html:tests/reports/coverage_unit
    --cov-report=xml:tests/reports/coverage.xml
    --cov-report=json:tests/reports/coverage.json
    --cov-fail-under=4
    --asyncio-mode=auto
    --timeout=300
    -v
    -ra
    -q
    --color=yes
    --code-highlight=yes
    --junitxml=tests/reports/junit.xml

norecursedirs =
    .vscode
    .git
    .tox
    venv
    venv_tdd
    services/python-collector/src/marketprism_collector/py-dep
    backup
    tests/unit/errors
    tests/unit/python_collector/test_types.py

asyncio_mode = auto

filterwarnings =
    ignore::DeprecationWarning:redis.*
    ignore::pydantic.warnings.PydanticDeprecatedSince20
    ignore::DeprecationWarning:distutils.*
    ignore::DeprecationWarning:pkg_resources.*
    ignore::PendingDeprecationWarning
    ignore:The test .* is marked with '@pytest.mark.asyncio' but it is not an async function.*:pytest.PytestWarning

markers =
    unit: 单元测试
    integration: 集成测试
    performance: 性能测试
    load_testing: 负载测试
    rest_api: REST API相关测试
    websocket: WebSocket相关测试
    nats: NATS消息系统测试
    slow: 运行较慢的测试
    cross_exchange: 跨交易所测试
    data_consistency: 数据一致性测试
    real_api: 真实API集成测试
    resilience: 系统恢复能力测试
    stress: 压力测试
    memory: 内存测试
    network: 网络测试
    database: 数据库测试
    mock: Mock测试
    e2e: 端到端测试
    live_api: 使用真实交易所API的测试
    ci: CI/CD环境专用测试
    rate_limited: 需要频率限制的测试
    smoke: 冒烟测试
    regression: 回归测试