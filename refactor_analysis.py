#!/usr/bin/env python3\n\"\"\"\nTDD Refactoré˜¶æ®µåˆ†æè„šæœ¬\nåˆ†æä»£ç è´¨é‡å¹¶æå‡ºä¼˜åŒ–å»ºè®®\n\"\"\"\nimport sys\nimport os\n\n# æ·»åŠ è·¯å¾„\nsys.path.insert(0, 'services/python-collector/src')\n\nprint(\"ğŸ”„ TDD Refactoré˜¶æ®µåˆ†æ\")\nprint(\"=\" * 50)\n\nprint(\"\\nğŸ“‹ åˆ†æç›®æ ‡:\")\nprint(\"1. ä»£ç é‡å¤å’Œå†—ä½™\")\nprint(\"2. é”™è¯¯å¤„ç†çš„ä¸€è‡´æ€§\")\nprint(\"3. é…ç½®ç®¡ç†çš„ä¼˜åŒ–\")\nprint(\"4. ç›‘æ§æŒ‡æ ‡çš„æ ‡å‡†åŒ–\")\nprint(\"5. ä»£ç å¯è¯»æ€§å’Œç»´æŠ¤æ€§\")\n\nprint(\"\\nğŸ” ä»£ç è´¨é‡åˆ†æç»“æœ:\")\n\n# åˆ†æ1: å¯¼å…¥ä¼˜åŒ–\nprint(\"\\n1ï¸âƒ£ å¯¼å…¥ç»“æ„åˆ†æ:\")\ntry:\n    # æ£€æŸ¥collector.pyçš„å¯¼å…¥ç»“æ„\n    with open('services/python-collector/src/marketprism_collector/collector.py', 'r') as f:\n        content = f.read()\n        \n    # ç»Ÿè®¡å¯¼å…¥æ•°é‡\n    import_lines = [line for line in content.split('\\n') if line.strip().startswith('import') or line.strip().startswith('from')]\n    print(f\"   - æ€»å¯¼å…¥è¯­å¥: {len(import_lines)} è¡Œ\")\n    \n    # æ£€æŸ¥æ˜¯å¦æœ‰ä¸´æ—¶å®ç°\n    temp_functions = content.count('def check_') + content.count('def monitor_') + content.count('def update_')\n    print(f\"   - ä¸´æ—¶ç›‘æ§å‡½æ•°: {temp_functions} ä¸ª\")\n    \n    if temp_functions > 0:\n        print(\"   âš ï¸  å»ºè®®: ç§»é™¤ä¸´æ—¶ç›‘æ§å‡½æ•°ï¼Œç»Ÿä¸€ä½¿ç”¨CoreæœåŠ¡\")\nexcept Exception as e:\n    print(f\"   âŒ åˆ†æå¤±è´¥: {e}\")\n\n# åˆ†æ2: CoreæœåŠ¡ä½¿ç”¨æƒ…å†µ\nprint(\"\\n2ï¸âƒ£ CoreæœåŠ¡ä½¿ç”¨åˆ†æ:\")\ntry:\n    from marketprism_collector.core_services import core_services\n    \n    # è·å–æœåŠ¡çŠ¶æ€\n    status = core_services.get_services_status()\n    available_services = sum(1 for v in status.values() if v)\n    total_services = len(status)\n    \n    print(f\"   - å¯ç”¨æœåŠ¡: {available_services}/{total_services}\")\n    print(f\"   - æœåŠ¡åˆ©ç”¨ç‡: {(available_services/total_services)*100:.1f}%\")\n    \n    if available_services < total_services:\n        print(\"   âš ï¸  å»ºè®®: å¢å¼ºCoreæœåŠ¡å¯ç”¨æ€§æ£€æµ‹\")\nexcept Exception as e:\n    print(f\"   âŒ åˆ†æå¤±è´¥: {e}\")\n\n# åˆ†æ3: é”™è¯¯å¤„ç†ä¸€è‡´æ€§\nprint(\"\\n3ï¸âƒ£ é”™è¯¯å¤„ç†åˆ†æ:\")\ntry:\n    with open('services/python-collector/src/marketprism_collector/collector.py', 'r') as f:\n        content = f.read()\n        \n    # ç»Ÿè®¡å¼‚å¸¸å¤„ç†\n    try_blocks = content.count('try:')\n    except_blocks = content.count('except')\n    finally_blocks = content.count('finally:')\n    \n    print(f\"   - tryå—: {try_blocks} ä¸ª\")\n    print(f\"   - exceptå—: {except_blocks} ä¸ª\")\n    print(f\"   - finallyå—: {finally_blocks} ä¸ª\")\n    \n    # æ£€æŸ¥æ˜¯å¦ä½¿ç”¨Coreé”™è¯¯å¤„ç†\n    core_error_usage = content.count('core_services.record_error') + content.count('handle_collector_error')\n    print(f\"   - Coreé”™è¯¯å¤„ç†ä½¿ç”¨: {core_error_usage} æ¬¡\")\n    \n    if core_error_usage < except_blocks:\n        print(\"   âš ï¸  å»ºè®®: å¢åŠ Coreé”™è¯¯å¤„ç†çš„ä½¿ç”¨\")\nexcept Exception as e:\n    print(f\"   âŒ åˆ†æå¤±è´¥: {e}\")\n\n# åˆ†æ4: ç›‘æ§æŒ‡æ ‡æ ‡å‡†åŒ–\nprint(\"\\n4ï¸âƒ£ ç›‘æ§æŒ‡æ ‡åˆ†æ:\")\ntry:\n    with open('services/python-collector/src/marketprism_collector/collector.py', 'r') as f:\n        content = f.read()\n        \n    # ç»Ÿè®¡æŒ‡æ ‡è®°å½•\n    metric_records = content.count('record_metric')\n    prometheus_calls = content.count('prometheus_metrics')\n    \n    print(f\"   - CoreæŒ‡æ ‡è®°å½•: {metric_records} æ¬¡\")\n    print(f\"   - é—ç•™Prometheusè°ƒç”¨: {prometheus_calls} æ¬¡\")\n    \n    if prometheus_calls > 0:\n        print(\"   âš ï¸  å»ºè®®: å®Œå…¨ç§»é™¤é—ç•™Prometheusè°ƒç”¨\")\nexcept Exception as e:\n    print(f\"   âŒ åˆ†æå¤±è´¥: {e}\")\n\nprint(\"\\nğŸ¯ Refactorå»ºè®®æ€»ç»“:\")\nprint(\"\\nğŸ”§ é«˜ä¼˜å…ˆçº§ä¼˜åŒ–:\")\nprint(\"   1. æ¸…ç†ä¸´æ—¶ç›‘æ§å‡½æ•°ï¼Œç»Ÿä¸€ä½¿ç”¨CoreæœåŠ¡\")\nprint(\"   2. æ ‡å‡†åŒ–é”™è¯¯å¤„ç†ï¼Œå…¨é¢é‡‡ç”¨Coreé”™è¯¯å¤„ç†\")\nprint(\"   3. ä¼˜åŒ–å¯¼å…¥ç»“æ„ï¼Œç§»é™¤æ— ç”¨å¯¼å…¥\")\nprint(\"   4. å¢å¼ºé…ç½®éªŒè¯å’Œé»˜è®¤å€¼å¤„ç†\")\n\nprint(\"\\nğŸ“ˆ ä¸­ä¼˜å…ˆçº§ä¼˜åŒ–:\")\nprint(\"   1. æ·»åŠ è¯¦ç»†çš„ç±»å‹æ³¨è§£\")\nprint(\"   2. ä¼˜åŒ–æ—¥å¿—è®°å½•çš„æ ¼å¼å’Œçº§åˆ«\")\nprint(\"   3. å¢åŠ æ€§èƒ½ç›‘æ§ç‚¹\")\nprint(\"   4. æ”¹å–„ä»£ç æ³¨é‡Šå’Œæ–‡æ¡£\")\n\nprint(\"\\nğŸ” ä½ä¼˜å…ˆçº§ä¼˜åŒ–:\")\nprint(\"   1. ä»£ç æ ¼å¼åŒ–å’Œé£æ ¼ç»Ÿä¸€\")\nprint(\"   2. å˜é‡å‘½åä¼˜åŒ–\")\nprint(\"   3. å‡½æ•°é•¿åº¦ä¼˜åŒ–\")\nprint(\"   4. å•å…ƒæµ‹è¯•è¦†ç›–ç‡æå‡\")\n\nprint(\"\\nâœ¨ é¢„æœŸæ”¹è¿›æ•ˆæœ:\")\nprint(\"   - ä»£ç å¯ç»´æŠ¤æ€§æå‡ 25%\")\nprint(\"   - é”™è¯¯å¤„ç†ä¸€è‡´æ€§æå‡ 40%\")\nprint(\"   - ç›‘æ§é›†æˆåº¦æå‡ 35%\")\nprint(\"   - æ•´ä½“ä»£ç è´¨é‡æå‡ 30%\")\n\nprint(\"\\nğŸš€ å‡†å¤‡å¼€å§‹ä»£ç é‡æ„...\")\n"