# MarketPrism 统一管理配置（scripts/manage.conf）
#
# 作用：控制 manage_all.sh 及各模块 scripts/manage.sh 的通用开关
#
# - BLOCK_ON_CONFLICT
#   当为 true 时：启动/初始化前若检测到进程/容器/端口冲突，将直接阻断启动并给出处理建议
#   当为 false 时：仅打印警告，不阻断（默认）
#   可选值：true/false/1/0/yes/no（大小写均可）
#
# 使用：
#   echo 'BLOCK_ON_CONFLICT=true' >> scripts/manage.conf
#   或直接编辑本文件，将下方值改为 true

BLOCK_ON_CONFLICT=false



# ================= 自定义网络/IP 配置（集中统一） =================
# 对外可达的主机 IP（当前主机 IP）
PUBLIC_IP=43.156.224.10

# 冷端（模拟远端）IP；如未设置将回退到 PUBLIC_IP
COLD_REMOTE_IP=43.156.224.10

# 启动策略
# - 跳过本地冷端，由你在 services/cold-storage-service 目录独立启动
SKIP_COLD_LOCAL=true
# - 冷端健康检查地址（用于 manage_all 的等待与校验）
COLD_STORAGE_HEALTH_URL=http://43.156.224.10:8086/health
# - 冷端 ClickHouse HTTP 地址（统计/探活用）
COLD_CH_HTTP_URL=http://43.156.224.10:8124

# 监控栈配置应用策略：启动前自动将 Prometheus 配置中的 host.docker.internal/旧IP 替换为 PUBLIC_IP
APPLY_PROMETHEUS_IP_FROM_CONFIG=true

# 安全：IP 白名单（本机防火墙的“入站控制”）
# - FULLMESH_IPS：这组来源 IP 对“本机的所有端口”均放行（空格/逗号分隔）。用于“两台机器之间全端口互通”。
# - WHITELIST_IPS + WHITELIST_PORTS：这组来源 IP 仅对列出的端口放行（精细化控制）。
# - 冷端在另一台机器时：在“冷端机器”上放行 8086/9095/8124/9000 给需要访问冷端的 IP（如 Prometheus/运维/开发机）
# - 复制需要：在“热端机器”上放行 9000 给“冷端机器的IP”（因为冷端会主动连接热端 ClickHouse TCP 9000）
# - 默认值已包含 127.0.0.1、常见 Docker 网段与 43.156.224.10；远程来源未来只需把IP追加到此变量
FULLMESH_IPS="43.156.224.10,43.156.224.10"
WHITELIST_IPS="127.0.0.1 172.16.0.0/12 43.156.224.10"
# - 需要开放给白名单 IP 的端口集合（热端：8085/9094/8123；冷端：8086/9095/8124/9000/9001；采集器：8087/9092；NATS：4222/8222）
WHITELIST_PORTS="8085 8086 8087 8123 8124 4222 8222 9000 9001 9092 9094 9095"
# - 是否在 start 之前自动应用（需要 sudo 权限；true=自动应用）
APPLY_IP_WHITELIST=true
