# MarketPrism Message Broker - Docker环境变量配置
# 复制此文件为 .env 并根据需要修改配置

# ==================== 基础服务配置 ====================
# 运行环境配置
ENVIRONMENT=production
SERVICE_HOST=0.0.0.0
SERVICE_PORT=8085
LOG_LEVEL=INFO
LOG_FORMAT=json

# 性能配置
MAX_CONNECTIONS=1000
REQUEST_TIMEOUT=30

# ==================== NATS连接配置 ====================
# 变量统一：优先使用 MARKETPRISM_NATS_URL；如需兼容历史脚本，可同时设置 NATS_URL，但以 MARKETPRISM_NATS_URL 为准

# NATS服务器连接
MARKETPRISM_NATS_URL=nats://nats:4222
NATS_CLIENT_NAME=marketprism-message-broker

# NATS连接参数
NATS_MAX_RECONNECT=10
NATS_RECONNECT_WAIT=2
NATS_PING_INTERVAL=120
NATS_MAX_PINGS=2

# NATS认证（可选，生产环境建议启用）
# NATS_USERNAME=marketprism
# NATS_PASSWORD=your_secure_password
# NATS_TOKEN=your_secure_token

# NATS TLS配置（可选，生产环境建议启用）
NATS_TLS_ENABLED=false
# NATS_TLS_CERT=/app/certs/client.crt
# NATS_TLS_KEY=/app/certs/client.key
# NATS_TLS_CA=/app/certs/ca.crt

# ==================== JetStream配置 ====================
# JetStream基础配置
JETSTREAM_ENABLED=true
STREAM_NAME=MARKET_DATA

# JetStream存储配置
JETSTREAM_RETENTION=limits
JETSTREAM_MAX_CONSUMERS=50
JETSTREAM_MAX_MSGS=1000000
JETSTREAM_MAX_BYTES=1073741824
JETSTREAM_MAX_AGE=7200
JETSTREAM_DISCARD=old
JETSTREAM_STORAGE=file
JETSTREAM_REPLICAS=1

# ==================== JetStream消费者配置 ====================
# JetStream消费者配置（全系统统一配置，确保一致性）
LSR_DELIVER_POLICY=last
LSR_ACK_POLICY=explicit
LSR_ACK_WAIT=60
LSR_MAX_DELIVER=3
LSR_MAX_ACK_PENDING=2000
# NOTE: ORDERBOOK_SNAP 消费者在运行时使用更高的 MAX_ACK_PENDING=5000（代码层覆盖，适配高频订单簿）；
# 其余消费者维持本处默认 2000。


# 流架构配置
ORDERBOOK_SNAP_ENABLED=true      # 启用订单簿独立流（性能优化）
MARKET_DATA_ENABLED=true         # 启用主数据流

# 数据过滤（可选）
# LSR_EXCHANGES=binance_derivatives,okx_derivatives
# LSR_SYMBOLS=BTC-USDT,ETH-USDT

# ==================== 监控配置 ====================
# 健康检查
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_ENDPOINT=/health
HEALTH_CHECK_INTERVAL=30

# 监控指标
METRICS_ENABLED=true
METRICS_ENDPOINT=/metrics

# 状态信息
STATUS_ENABLED=true
STATUS_ENDPOINT=/status

# 统计信息
STATS_ENABLED=true
STATS_RESET_INTERVAL=3600

# ==================== 安全配置 ====================
# CORS配置
CORS_ENABLED=true
CORS_ORIGINS=*
CORS_METHODS=GET,POST,OPTIONS
CORS_HEADERS=*

# 访问控制（生产环境建议启用）
ACCESS_CONTROL_ENABLED=false
# API_KEY=your_secure_api_key
RATE_LIMIT=100

# ==================== 日志配置 ====================
# 日志输出
LOG_CONSOLE_ENABLED=true
LOG_CONSOLE_LEVEL=INFO

# 文件日志（可选）
LOG_FILE_ENABLED=false
LOG_FILE_LEVEL=DEBUG
LOG_FILE_PATH=/app/logs/message-broker.log
LOG_FILE_MAX_SIZE=100MB
LOG_FILE_BACKUP_COUNT=5

# ==================== 开发调试配置 ====================
# 调试模式（开发环境使用）
DEBUG_MODE=false
VERBOSE_LOGGING=false

# 性能分析（开发环境使用）
PROFILING_ENABLED=false
PROFILING_OUTPUT=/app/logs/profiling

# 测试模式（测试环境使用）
TEST_MODE=false
MOCK_DATA_ENABLED=false

# ==================== 资源限制配置 ====================
# 内存限制
MEMORY_LIMIT=512MB
MEMORY_WARNING=80

# CPU限制
CPU_LIMIT=1.0
CPU_WARNING=80

# 连接限制
MAX_CONCURRENT_CONNECTIONS=1000
CONNECTION_TIMEOUT=30

# ==================== Docker Compose专用变量 ====================
# 以下变量通常在docker-compose.yml中设置

# 容器名称
CONTAINER_NAME=marketprism-message-broker

# 网络配置
DOCKER_NETWORK=marketprism-network

# 数据卷
CONFIG_VOLUME=./config:/app/config:ro
LOGS_VOLUME=./logs:/app/logs

# 依赖服务
NATS_SERVICE=nats
NATS_HEALTH_CHECK=service_healthy

# ==================== 环境特定配置示例 ====================

# 开发环境配置示例：
# ENVIRONMENT=development
# LOG_LEVEL=DEBUG
# DEBUG_MODE=true
# VERBOSE_LOGGING=true
# MARKETPRISM_NATS_URL=nats://localhost:4222

# 测试环境配置示例：
# ENVIRONMENT=staging
# LOG_LEVEL=INFO
# TEST_MODE=true
# MARKETPRISM_NATS_URL=nats://nats-staging:4222

# 生产环境配置示例：
# ENVIRONMENT=production
# LOG_LEVEL=WARNING
# ACCESS_CONTROL_ENABLED=true
# API_KEY=your_production_api_key
# NATS_TLS_ENABLED=true
# NATS_USERNAME=prod_user
# NATS_PASSWORD=secure_prod_password

# ==================== 使用说明 ====================
# 1. 复制此文件为 .env：
#    cp .env.docker .env
#
# 2. 根据环境修改相应的配置值
#
# 3. 在docker-compose.yml中引用：
#    env_file:
#      - .env
#
# 4. 或者直接在docker run命令中使用：
#    docker run --env-file .env marketprism-message-broker
#
# 5. 也可以通过-e参数单独设置：
#    docker run -e MARKETPRISM_NATS_URL=nats://my-nats:4222 marketprism-message-broker
