# MarketPrism统一NATS容器 - 环境变量配置文件
# 简化架构：单一NATS容器集成所有Message Broker功能
#
# 🎯 功能说明：
# - 支持所有7种数据类型（orderbook, trade, funding_rate, open_interest, lsr_top_position, lsr_all_account, volatility_index）
# - 与unified_data_collection.yaml完全兼容
# - 提供开发、测试、生产环境的不同配置
#
# 📋 使用方法：
# 1. 复制此文件为 .env
# 2. 根据环境需求修改配置值
# 3. 使用 docker-compose --env-file .env up 启动

# ==================== 基础服务配置 ====================
# NATS服务器基础配置
NATS_SERVER_NAME=marketprism-nats-unified
NATS_HOST=0.0.0.0
NATS_PORT=4222
NATS_HTTP_PORT=8222
NATS_CLUSTER_PORT=6222

# ==================== JetStream配置 ====================
# JetStream基础配置
JETSTREAM_ENABLED=true
JETSTREAM_STORE_DIR=/data/jetstream

# JetStream存储限制
# 开发环境：较小的存储限制
JETSTREAM_MAX_MEMORY=1GB
JETSTREAM_MAX_FILE=10GB

# 生产环境建议值：
# JETSTREAM_MAX_MEMORY=4GB
# JETSTREAM_MAX_FILE=50GB

# ==================== 流配置 ====================
# MARKET_DATA流配置（支持所有7种数据类型）
STREAM_NAME=MARKET_DATA
STREAM_MAX_CONSUMERS=50
STREAM_MAX_MSGS=1000000
STREAM_MAX_BYTES=1073741824
STREAM_MAX_AGE=7200
STREAM_REPLICAS=1
STREAM_DUPLICATE_WINDOW=300

# 生产环境建议值：
# STREAM_MAX_CONSUMERS=100
# STREAM_MAX_MSGS=10000000
# STREAM_MAX_BYTES=10737418240
# STREAM_MAX_AGE=86400

# ==================== 日志配置 ====================
# NATS服务器日志配置
NATS_LOG_FILE=/var/log/nats/nats.log
NATS_LOG_TIME=true

# 开发环境：启用调试日志
NATS_DEBUG=false
NATS_TRACE=false

# 生产环境建议值：
# NATS_DEBUG=false
# NATS_TRACE=false

# ==================== 监控配置 ====================
# 监控和健康检查配置
MONITORING_ENABLED=true
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL=60

# 开发环境建议值：
# HEALTH_CHECK_INTERVAL=30

# ==================== 连接配置 ====================
# NATS连接限制配置
NATS_MAX_CONNECTIONS=1000
NATS_MAX_CONTROL_LINE=4096
NATS_MAX_PAYLOAD=1MB
NATS_MAX_PENDING=64MB

# 生产环境建议值：
# NATS_MAX_CONNECTIONS=5000
# NATS_MAX_PAYLOAD=2MB
# NATS_MAX_PENDING=128MB

# ==================== 认证配置 ====================
# NATS认证配置（生产环境建议启用）
NATS_AUTH_ENABLED=false
NATS_AUTH_USERNAME=
NATS_AUTH_PASSWORD=
NATS_AUTH_TOKEN=

# 生产环境示例：
# NATS_AUTH_ENABLED=true
# NATS_AUTH_USERNAME=marketprism
# NATS_AUTH_PASSWORD=your_secure_password_here
# 或使用令牌认证：
# NATS_AUTH_TOKEN=your_secure_token_here

# ==================== 集群配置 ====================
# NATS集群配置（多节点部署时启用）
NATS_CLUSTER_ENABLED=false
NATS_CLUSTER_NAME=marketprism-cluster
NATS_CLUSTER_ROUTES=

# 多节点集群示例：
# NATS_CLUSTER_ENABLED=true
# NATS_CLUSTER_ROUTES=nats://nats-node-1:6222,nats://nats-node-2:6222

# ==================== 操作配置 ====================
# 初始化和连接超时配置
INIT_TIMEOUT=60
NATS_CONNECT_TIMEOUT=10
NATS_MAX_RECONNECT=10

# ==================== Docker配置 ====================
# Docker Compose相关配置
BUILD_DATE=
VCS_REF=
VERSION=2.0.0-unified

# 资源限制
MEMORY_LIMIT=2G
CPU_LIMIT=2.0
MEMORY_RESERVATION=512M
CPU_RESERVATION=0.5

# 网络配置
NETWORK_SUBNET=172.20.0.0/16

# 数据目录配置
DATA_DIR=./data
LOG_DIR=./logs

# 日志配置
LOG_MAX_SIZE=50m
LOG_MAX_FILE=5

# ==================== 环境特定配置 ====================
# 当前环境类型（development/testing/production）
ENVIRONMENT=development

# 开发环境配置
# NATS_DEBUG=true
# JETSTREAM_MAX_MEMORY=512MB
# JETSTREAM_MAX_FILE=2GB
# STREAM_MAX_MSGS=100000
# HEALTH_CHECK_INTERVAL=30

# 测试环境配置
# NATS_DEBUG=true
# NATS_TRACE=true
# JETSTREAM_MAX_MEMORY=256MB
# JETSTREAM_MAX_FILE=1GB
# STREAM_MAX_MSGS=10000
# HEALTH_CHECK_INTERVAL=15

# 生产环境配置
# NATS_DEBUG=false
# NATS_TRACE=false
# JETSTREAM_MAX_MEMORY=4GB
# JETSTREAM_MAX_FILE=50GB
# STREAM_MAX_MSGS=10000000
# HEALTH_CHECK_INTERVAL=60
# NATS_AUTH_ENABLED=true

# ==================== 数据类型支持验证 ====================
# 支持的数据类型（用于验证，不需要修改）
# 1. orderbook-data.>           - 订单簿数据（所有交易所）
# 2. trade-data.>               - 交易数据（所有交易所）
# 3. funding-rate-data.>        - 资金费率（衍生品交易所）
# 4. open-interest-data.>       - 未平仓量（衍生品交易所）
# 5. lsr-top-position-data.>    - LSR顶级持仓（衍生品交易所）
# 6. lsr-all-account-data.>     - LSR全账户（衍生品交易所）
# 7. volatility_index-data.>    - 波动率指数（Deribit）

# ==================== 兼容性配置 ====================
# 与unified_data_collection.yaml的兼容性配置
# NATS连接URL（Data Collector使用）
NATS_URL=nats://localhost:4222

# 客户端名称
NATS_CLIENT_NAME=unified-collector

# JetStream启用标志
JETSTREAM_ENABLED=true

# ==================== 安全配置 ====================
# TLS配置（生产环境建议启用）
NATS_TLS_ENABLED=false
NATS_TLS_CERT=
NATS_TLS_KEY=
NATS_TLS_CA=

# 生产环境TLS示例：
# NATS_TLS_ENABLED=true
# NATS_TLS_CERT=/app/certs/server.crt
# NATS_TLS_KEY=/app/certs/server.key
# NATS_TLS_CA=/app/certs/ca.crt

# ==================== 监控和告警配置 ====================
# 外部监控集成配置
PROMETHEUS_ENABLED=false
PROMETHEUS_PORT=7777

# 告警配置
ALERT_WEBHOOK_URL=
ALERT_EMAIL=
ALERT_SLACK_WEBHOOK=

# ==================== 备份配置 ====================
# JetStream数据备份配置
BACKUP_ENABLED=false
BACKUP_INTERVAL=3600
BACKUP_RETENTION_DAYS=7
BACKUP_S3_BUCKET=
BACKUP_S3_REGION=

# ==================== 调试配置 ====================
# 调试和故障排除配置
DEBUG_MODE=false
VERBOSE_LOGGING=false
PERFORMANCE_MONITORING=false

# 开发调试时启用：
# DEBUG_MODE=true
# VERBOSE_LOGGING=true
# PERFORMANCE_MONITORING=true
