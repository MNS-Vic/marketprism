global:
  resolve_timeout: 5m

route:
  receiver: 'null'
  group_by: ['alertname', 'service']
  group_wait: 10s
  group_interval: 1m
  repeat_interval: 2h
  routes:
    # Critical 告警：更频繁的重复通知
    - matchers:
        - severity="critical"
      receiver: 'null'
      group_wait: 10s
      group_interval: 30s
      repeat_interval: 10m
      continue: false
    # Warning 告警：默认配置
    - matchers:
        - severity="warning"
      receiver: 'null'
      repeat_interval: 2h
      continue: false
    # 其他告警
    - receiver: 'null'
      continue: false
    # 邮件告警已暂时关闭 (2025-10-18)
    # - matchers: ['severity="critical"']
    #   receiver: 'email-alerts'
    #   group_wait: 0s
    #   group_interval: 30s

receivers:
  - name: 'null'

  - name: 'dingtalk'
    webhook_configs:
      - url: 'http://dingtalk:8060/dingtalk/marketprism/send'
        send_resolved: true

  # 邮件告警接收器已暂时关闭 (2025-10-18)
  # 如需启用，取消注释以下配置并在 route 中启用对应路由
  # - name: 'email-alerts'
  #   email_configs:
  #     - to: '79071102@qq.com'
  #       from: '1285574495@qq.com'
  #       smarthost: 'smtp.qq.com:587'
  #       auth_username: '1285574495@qq.com'
  #       auth_password: 'grchxhnxzyngbaac'
  #       require_tls: true
  #       send_resolved: true
  #       headers:
  #         Subject: '[MarketPrism Alert] {{ .Status | toUpper }}: {{ .CommonLabels.alertname }} {{ if .CommonLabels.service }}({{ .CommonLabels.service }}){{ end }}'

# Inhibition rules to avoid alert storms
inhibit_rules:
  - source_matchers: ['alertname="BrokerDown"','severity="critical"']
    target_matchers: ['service=~"hot-storage|cold-storage|collector"']
    equal: []
  - source_matchers: ['alertname="ClickHouseHotDown"','severity="critical"']
    target_matchers: ['service="hot-storage"']
    equal: []
  - source_matchers: ['alertname="ClickHouseColdDown"','severity="critical"']
    target_matchers: ['service="cold-storage"']
    equal: []
