# ğŸ¯ MarketPrism TDD ç»¼åˆæµ‹è¯•è®¡åˆ’

> **ç›®æ ‡**: å°†æµ‹è¯•è¦†ç›–ç‡ä»å½“å‰3%æå‡è‡³90%ä»¥ä¸Š  
> **ç­–ç•¥**: åˆ†å±‚æµ‹è¯• + ä¼˜å…ˆçº§é©±åŠ¨ + çœŸå®åœºæ™¯è¦†ç›–  
> **æ—¶é—´**: åˆ†4ä¸ªé˜¶æ®µå®æ–½  

## ğŸ“Š é¡¹ç›®ç°çŠ¶åˆ†æ

### å½“å‰æ¶æ„
- **Core Layer**: 50ä¸ªPythonæ–‡ä»¶ï¼Œ15,226è¡Œä»£ç 
- **Services Layer**: 6ä¸ªå¾®æœåŠ¡
- **å½“å‰è¦†ç›–ç‡**: 3% (459/15,226è¡Œ)
- **æµ‹è¯•æ–‡ä»¶**: 150ä¸ªæµ‹è¯•æ–‡ä»¶

### æŠ€æœ¯æ ˆ
- Python 3.11+, FastAPI, aiohttp
- NATS JetStream, ClickHouse, Redis  
- Docker, Prometheusç›‘æ§

## ğŸ¯ æµ‹è¯•ç­–ç•¥

### åˆ†å±‚æµ‹è¯•ç­–ç•¥
```
å•å…ƒæµ‹è¯• (60%ç›®æ ‡) - æµ‹è¯•å•ä¸ªå‡½æ•°å’Œç±»
â”œâ”€â”€ Coreç»„ä»¶æµ‹è¯•
â”œâ”€â”€ æœåŠ¡é€»è¾‘æµ‹è¯•
â””â”€â”€ å·¥å…·å‡½æ•°æµ‹è¯•

é›†æˆæµ‹è¯• (25%ç›®æ ‡) - æµ‹è¯•ç»„ä»¶é—´äº¤äº’  
â”œâ”€â”€ æœåŠ¡é—´é€šä¿¡æµ‹è¯•
â”œâ”€â”€ æ•°æ®åº“é›†æˆæµ‹è¯•
â””â”€â”€ æ¶ˆæ¯é˜Ÿåˆ—é›†æˆæµ‹è¯•

ç«¯åˆ°ç«¯æµ‹è¯• (5%ç›®æ ‡) - æµ‹è¯•å®Œæ•´æ•°æ®æµ
â”œâ”€â”€ çœŸå®APIé›†æˆæµ‹è¯•
â”œâ”€â”€ å®Œæ•´æ•°æ®æµæµ‹è¯•
â””â”€â”€ æ€§èƒ½åŸºå‡†æµ‹è¯•
```

### ä¼˜å…ˆçº§çŸ©é˜µ

| ä¼˜å…ˆçº§ | ç»„ä»¶ | è¦†ç›–ç‡ç›®æ ‡ | æµ‹è¯•æ–‡ä»¶æ•° |
|--------|------|-----------|-----------|
| P0 | æ•°æ®æ”¶é›†å™¨ | 95% | 15 |
| P0 | é…ç½®ç®¡ç† | 90% | 12 |
| P0 | å­˜å‚¨ç®¡ç† | 90% | 10 |
| P0 | é”™è¯¯å¤„ç† | 85% | 8 |
| P1 | ç½‘ç»œç®¡ç† | 80% | 10 |
| P1 | å¯é æ€§ç»„ä»¶ | 80% | 12 |
| P1 | ç›‘æ§ç³»ç»Ÿ | 75% | 8 |
| P2 | ä¸­é—´ä»¶ | 70% | 8 |
| P2 | ç¼“å­˜ç³»ç»Ÿ | 70% | 6 |
| P2 | å®‰å…¨ç»„ä»¶ | 65% | 5 |

## ğŸ“‹ Phase 1: æ ¸å¿ƒç»„ä»¶å•å…ƒæµ‹è¯• (P0)

### 1.1 æ•°æ®æ”¶é›†å™¨æµ‹è¯• (services/data-collector/)
```python
# æµ‹è¯•æ–‡ä»¶ç»“æ„
tests/unit/services/data_collector/
â”œâ”€â”€ test_collector_core.py           # æ ¸å¿ƒæ”¶é›†å™¨é€»è¾‘
â”œâ”€â”€ test_exchange_adapters.py        # äº¤æ˜“æ‰€é€‚é…å™¨
â”œâ”€â”€ test_data_normalizer.py          # æ•°æ®æ ‡å‡†åŒ–
â”œâ”€â”€ test_websocket_manager.py        # WebSocketç®¡ç†
â”œâ”€â”€ test_orderbook_manager.py        # è®¢å•ç°¿ç®¡ç†
â”œâ”€â”€ test_subscription_manager.py     # è®¢é˜…ç®¡ç†
â”œâ”€â”€ test_error_recovery.py           # é”™è¯¯æ¢å¤
â”œâ”€â”€ test_metrics_collection.py       # æŒ‡æ ‡æ”¶é›†
â”œâ”€â”€ test_health_checker.py           # å¥åº·æ£€æŸ¥
â””â”€â”€ test_config_validation.py        # é…ç½®éªŒè¯
```

**å…³é”®æµ‹è¯•åœºæ™¯**:
- âœ… å¤šäº¤æ˜“æ‰€è¿æ¥ç®¡ç†
- âœ… å®æ—¶æ•°æ®æ¥æ”¶å’Œå¤„ç†
- âœ… æ•°æ®æ ‡å‡†åŒ–å’ŒéªŒè¯
- âœ… é”™è¯¯å¤„ç†å’Œé‡è¿æœºåˆ¶
- âœ… æ€§èƒ½æŒ‡æ ‡æ”¶é›†

### 1.2 é…ç½®ç®¡ç†æµ‹è¯• (core/config/)
```python
# æµ‹è¯•æ–‡ä»¶ç»“æ„  
tests/unit/core/config/
â”œâ”€â”€ test_unified_config_manager.py   # ç»Ÿä¸€é…ç½®ç®¡ç†å™¨
â”œâ”€â”€ test_config_validation.py        # é…ç½®éªŒè¯
â”œâ”€â”€ test_environment_override.py     # ç¯å¢ƒå˜é‡è¦†ç›–
â”œâ”€â”€ test_hot_reload.py               # çƒ­é‡è½½
â”œâ”€â”€ test_config_factory.py           # é…ç½®å·¥å‚
â”œâ”€â”€ test_config_registry.py          # é…ç½®æ³¨å†Œè¡¨
â””â”€â”€ test_migration_tool.py           # é…ç½®è¿ç§»å·¥å…·
```

**å…³é”®æµ‹è¯•åœºæ™¯**:
- âœ… é…ç½®æ–‡ä»¶åŠ è½½å’Œè§£æ
- âœ… ç¯å¢ƒå˜é‡è¦†ç›–æœºåˆ¶
- âœ… é…ç½®çƒ­é‡è½½åŠŸèƒ½
- âœ… é…ç½®éªŒè¯å’Œé”™è¯¯å¤„ç†
- âœ… å¤šç¯å¢ƒé…ç½®ç®¡ç†

### 1.3 å­˜å‚¨ç®¡ç†æµ‹è¯• (core/storage/)
```python
# æµ‹è¯•æ–‡ä»¶ç»“æ„
tests/unit/core/storage/
â”œâ”€â”€ test_unified_storage_manager.py  # ç»Ÿä¸€å­˜å‚¨ç®¡ç†å™¨
â”œâ”€â”€ test_clickhouse_writer.py        # ClickHouseå†™å…¥å™¨
â”œâ”€â”€ test_archive_manager.py          # å½’æ¡£ç®¡ç†å™¨
â”œâ”€â”€ test_storage_factory.py          # å­˜å‚¨å·¥å‚
â”œâ”€â”€ test_hot_cold_storage.py         # çƒ­å†·å­˜å‚¨
â””â”€â”€ test_data_types.py               # æ•°æ®ç±»å‹
```

**å…³é”®æµ‹è¯•åœºæ™¯**:
- âœ… ClickHouseè¿æ¥å’Œå†™å…¥
- âœ… çƒ­å­˜å‚¨å’Œå†·å­˜å‚¨åˆ‡æ¢
- âœ… æ•°æ®å½’æ¡£å’Œæ¸…ç†
- âœ… å­˜å‚¨æ€§èƒ½ä¼˜åŒ–
- âœ… æ•°æ®ä¸€è‡´æ€§ä¿è¯

### 1.4 é”™è¯¯å¤„ç†æµ‹è¯• (core/errors/)
```python
# æµ‹è¯•æ–‡ä»¶ç»“æ„
tests/unit/core/errors/
â”œâ”€â”€ test_unified_error_handler.py    # ç»Ÿä¸€é”™è¯¯å¤„ç†å™¨
â”œâ”€â”€ test_error_aggregator.py         # é”™è¯¯èšåˆå™¨
â”œâ”€â”€ test_recovery_manager.py         # æ¢å¤ç®¡ç†å™¨
â”œâ”€â”€ test_error_categories.py         # é”™è¯¯åˆ†ç±»
â””â”€â”€ test_error_context.py            # é”™è¯¯ä¸Šä¸‹æ–‡
```

## ğŸ“‹ Phase 2: ç½‘ç»œå’Œå¯é æ€§æµ‹è¯• (P1)

### 2.1 ç½‘ç»œç®¡ç†æµ‹è¯• (core/networking/)
```python
# æµ‹è¯•æ–‡ä»¶ç»“æ„
tests/unit/core/networking/
â”œâ”€â”€ test_connection_manager.py       # è¿æ¥ç®¡ç†å™¨
â”œâ”€â”€ test_websocket_manager.py        # WebSocketç®¡ç†å™¨
â”œâ”€â”€ test_proxy_manager.py            # ä»£ç†ç®¡ç†å™¨
â”œâ”€â”€ test_session_manager.py          # ä¼šè¯ç®¡ç†å™¨
â””â”€â”€ test_exchange_connector.py       # äº¤æ˜“æ‰€è¿æ¥å™¨
```

### 2.2 å¯é æ€§ç»„ä»¶æµ‹è¯• (core/reliability/)
```python
# æµ‹è¯•æ–‡ä»¶ç»“æ„
tests/unit/core/reliability/
â”œâ”€â”€ test_circuit_breaker.py          # ç†”æ–­å™¨
â”œâ”€â”€ test_rate_limiter.py              # é™æµå™¨
â”œâ”€â”€ test_retry_handler.py             # é‡è¯•å¤„ç†å™¨
â”œâ”€â”€ test_load_balancer.py             # è´Ÿè½½å‡è¡¡å™¨
â””â”€â”€ test_redundancy_manager.py        # å†—ä½™ç®¡ç†å™¨
```

## ğŸ“‹ Phase 3: é›†æˆæµ‹è¯•

### 3.1 æœåŠ¡é›†æˆæµ‹è¯•
```python
# æµ‹è¯•æ–‡ä»¶ç»“æ„
tests/integration/
â”œâ”€â”€ test_data_flow_integration.py    # æ•°æ®æµé›†æˆ
â”œâ”€â”€ test_service_communication.py    # æœåŠ¡é€šä¿¡
â”œâ”€â”€ test_database_integration.py     # æ•°æ®åº“é›†æˆ
â”œâ”€â”€ test_message_queue_integration.py # æ¶ˆæ¯é˜Ÿåˆ—é›†æˆ
â””â”€â”€ test_monitoring_integration.py   # ç›‘æ§é›†æˆ
```

### 3.2 çœŸå®APIé›†æˆæµ‹è¯•
```python
# æµ‹è¯•æ–‡ä»¶ç»“æ„
tests/integration/real_api/
â”œâ”€â”€ test_binance_integration.py      # Binanceé›†æˆ
â”œâ”€â”€ test_okx_integration.py          # OKXé›†æˆ
â”œâ”€â”€ test_deribit_integration.py      # Deribité›†æˆ
â””â”€â”€ test_multi_exchange_sync.py      # å¤šäº¤æ˜“æ‰€åŒæ­¥
```

## ğŸ“‹ Phase 4: ç«¯åˆ°ç«¯å’Œæ€§èƒ½æµ‹è¯•

### 4.1 ç«¯åˆ°ç«¯æµ‹è¯•
```python
# æµ‹è¯•æ–‡ä»¶ç»“æ„
tests/e2e/
â”œâ”€â”€ test_complete_data_pipeline.py   # å®Œæ•´æ•°æ®ç®¡é“
â”œâ”€â”€ test_system_resilience.py        # ç³»ç»Ÿå¼¹æ€§
â”œâ”€â”€ test_failover_scenarios.py       # æ•…éšœè½¬ç§»åœºæ™¯
â””â”€â”€ test_data_consistency.py         # æ•°æ®ä¸€è‡´æ€§
```

### 4.2 æ€§èƒ½æµ‹è¯•
```python
# æµ‹è¯•æ–‡ä»¶ç»“æ„
tests/performance/
â”œâ”€â”€ test_throughput_benchmarks.py    # ååé‡åŸºå‡†
â”œâ”€â”€ test_latency_measurements.py     # å»¶è¿Ÿæµ‹é‡
â”œâ”€â”€ test_memory_usage.py             # å†…å­˜ä½¿ç”¨
â””â”€â”€ test_concurrent_load.py          # å¹¶å‘è´Ÿè½½
```

## ğŸ› ï¸ æµ‹è¯•å·¥å…·å’Œæ¡†æ¶

### æ ¸å¿ƒæµ‹è¯•æ¡†æ¶
- **pytest**: ä¸»æµ‹è¯•æ¡†æ¶
- **pytest-asyncio**: å¼‚æ­¥æµ‹è¯•æ”¯æŒ
- **pytest-cov**: è¦†ç›–ç‡æµ‹è¯•
- **pytest-xdist**: å¹¶è¡Œæµ‹è¯•

### Mockå’ŒFixtureå·¥å…·
- **unittest.mock**: Pythonå†…ç½®Mock
- **aioresponses**: HTTP Mock
- **pytest-mock**: pytest Mockæ’ä»¶
- **factory-boy**: æµ‹è¯•æ•°æ®å·¥å‚

### æµ‹è¯•æ•°æ®ç®¡ç†
- **faker**: å‡æ•°æ®ç”Ÿæˆ
- **fixtures**: æµ‹è¯•å¤¹å…·
- **factories**: æ•°æ®å·¥å‚æ¨¡å¼

## ğŸ“ˆ è¦†ç›–ç‡ç›®æ ‡å’Œç›‘æ§

### è¦†ç›–ç‡ç›®æ ‡
- **æ€»ä½“ç›®æ ‡**: 90%+
- **æ ¸å¿ƒç»„ä»¶**: 95%+
- **æœåŠ¡å±‚**: 85%+
- **å·¥å…·å‡½æ•°**: 80%+

### ç›‘æ§æŒ‡æ ‡
- **ä»£ç è¦†ç›–ç‡**: è¡Œè¦†ç›–ç‡ã€åˆ†æ”¯è¦†ç›–ç‡
- **æµ‹è¯•æ‰§è¡Œæ—¶é—´**: å•å…ƒæµ‹è¯•<5sï¼Œé›†æˆæµ‹è¯•<30s
- **æµ‹è¯•ç¨³å®šæ€§**: æˆåŠŸç‡>99%
- **æ€§èƒ½åŸºå‡†**: ååé‡ã€å»¶è¿ŸæŒ‡æ ‡

## ğŸš€ å®æ–½è®¡åˆ’

### æ—¶é—´å®‰æ’
- **Phase 1**: 2å‘¨ - æ ¸å¿ƒç»„ä»¶å•å…ƒæµ‹è¯•
- **Phase 2**: 1.5å‘¨ - ç½‘ç»œå’Œå¯é æ€§æµ‹è¯•  
- **Phase 3**: 1å‘¨ - é›†æˆæµ‹è¯•
- **Phase 4**: 0.5å‘¨ - ç«¯åˆ°ç«¯å’Œæ€§èƒ½æµ‹è¯•

### é‡Œç¨‹ç¢‘
- **Week 1**: å®Œæˆæ•°æ®æ”¶é›†å™¨å’Œé…ç½®ç®¡ç†æµ‹è¯•
- **Week 2**: å®Œæˆå­˜å‚¨ç®¡ç†å’Œé”™è¯¯å¤„ç†æµ‹è¯•
- **Week 3**: å®Œæˆç½‘ç»œå’Œå¯é æ€§ç»„ä»¶æµ‹è¯•
- **Week 4**: å®Œæˆé›†æˆæµ‹è¯•
- **Week 5**: å®Œæˆç«¯åˆ°ç«¯æµ‹è¯•ï¼Œè¾¾æˆ90%è¦†ç›–ç‡ç›®æ ‡

## âœ… æˆåŠŸæ ‡å‡†

1. **è¦†ç›–ç‡è¾¾æ ‡**: æ€»ä½“è¦†ç›–ç‡â‰¥90%
2. **æµ‹è¯•è´¨é‡**: æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œæ— flakyæµ‹è¯•
3. **æ€§èƒ½åŸºå‡†**: æ»¡è¶³æ€§èƒ½è¦æ±‚
4. **æ–‡æ¡£å®Œæ•´**: æµ‹è¯•æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—å®Œæ•´
5. **CI/CDé›†æˆ**: è‡ªåŠ¨åŒ–æµ‹è¯•æµæ°´çº¿æ­£å¸¸è¿è¡Œ

---

**ä¸‹ä¸€æ­¥**: å¼€å§‹Phase 1çš„å®æ–½ï¼Œä»æ•°æ®æ”¶é›†å™¨æ ¸å¿ƒæµ‹è¯•å¼€å§‹
