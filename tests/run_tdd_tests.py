#!/usr/bin/env python3\n\"\"\"\nç›´æ¥è¿è¡ŒTDDæµ‹è¯•çš„è„šæœ¬ï¼Œç»•è¿‡pytesté—®é¢˜\n\"\"\"\nimport sys\nimport os\nimport traceback\n\n# æ·»åŠ æœç´¢è·¯å¾„\nsys.path.insert(0, os.path.join(os.path.dirname(__file__), '../services/python-collector/src'))\n\ndef run_test(test_name, test_func):\n    \"\"\"è¿è¡Œå•ä¸ªæµ‹è¯•\"\"\"\n    try:\n        test_func()\n        print(f\"âœ… {test_name} - PASSED\")\n        return True\n    except Exception as e:\n        print(f\"âŒ {test_name} - FAILED: {e}\")\n        traceback.print_exc()\n        return False\n\ndef test_collector_import():\n    \"\"\"æµ‹è¯•æ”¶é›†å™¨å¯¼å…¥\"\"\"\n    from marketprism_collector.collector import MarketDataCollector\n    assert MarketDataCollector is not None\n\ndef test_config_import():\n    \"\"\"æµ‹è¯•é…ç½®å¯¼å…¥\"\"\"\n    from marketprism_collector.config import Config\n    assert Config is not None\n\ndef test_core_services_available():\n    \"\"\"æµ‹è¯•CoreæœåŠ¡å¯ç”¨æ€§\"\"\"\n    from marketprism_collector.core_services import core_services\n    assert core_services is not None\n    \n    status = core_services.get_services_status()\n    assert isinstance(status, dict)\n    print(f\"   CoreæœåŠ¡çŠ¶æ€: {status}\")\n\ndef test_basic_collector_instantiation():\n    \"\"\"æµ‹è¯•åŸºç¡€æ”¶é›†å™¨å®ä¾‹åŒ–\"\"\"\n    from marketprism_collector.collector import MarketDataCollector\n    from types import SimpleNamespace\n    \n    # åˆ›å»ºæœ€å°é…ç½®\n    config = SimpleNamespace(\n        collector=SimpleNamespace(\n            http_port=8080,\n            exchanges=['binance'],\n            log_level='INFO'\n        ),\n        exchanges=SimpleNamespace(\n            binance=SimpleNamespace(\n                enabled=True,\n                websocket_url='wss://stream.binance.com:9443'\n            )\n        ),\n        nats=SimpleNamespace(\n            url='nats://localhost:4222'\n        )\n    )\n    \n    # å®ä¾‹åŒ–æ”¶é›†å™¨\n    collector = MarketDataCollector(config)\n    assert collector is not None\n    assert collector.config == config\n    assert not collector.is_running\n    print(f\"   æ”¶é›†å™¨åˆ›å»ºæˆåŠŸï¼Œç«¯å£: {config.collector.http_port}\")\n\ndef test_core_integration_works():\n    \"\"\"æµ‹è¯•Coreé›†æˆæ­£å¸¸å·¥ä½œ\"\"\"\n    from marketprism_collector.core_integration import (\n        get_core_integration,\n        log_collector_info,\n        handle_collector_error\n    )\n    \n    # è·å–é›†æˆå®ä¾‹\n    integration = get_core_integration()\n    assert integration is not None\n    print(f\"   Coreé›†æˆå®ä¾‹: {type(integration).__name__}\")\n    \n    # æµ‹è¯•æ—¥å¿—è®°å½•\n    log_collector_info(\"TDDæµ‹è¯•æ¶ˆæ¯\")\n    print(\"   æ—¥å¿—è®°å½•åŠŸèƒ½æ­£å¸¸\")\n    \n    # æµ‹è¯•é”™è¯¯å¤„ç†\n    test_error = ValueError(\"TDDæµ‹è¯•é”™è¯¯\")\n    error_id = handle_collector_error(test_error)\n    assert error_id is not None\n    assert isinstance(error_id, str)\n    print(f\"   é”™è¯¯å¤„ç†åŠŸèƒ½æ­£å¸¸ï¼Œé”™è¯¯ID: {error_id}\")\n\ndef test_config_path_manager():\n    \"\"\"æµ‹è¯•é…ç½®è·¯å¾„ç®¡ç†å™¨\"\"\"\n    from marketprism_collector.config_paths import config_paths\n    \n    # æµ‹è¯•è·¯å¾„è§£æ\n    project_root = config_paths.get_project_root()\n    assert project_root is not None\n    print(f\"   é¡¹ç›®æ ¹ç›®å½•: {project_root}\")\n    \n    config_dir = config_paths.get_config_dir()\n    assert config_dir is not None\n    print(f\"   é…ç½®ç›®å½•: {config_dir}\")\n\ndef main():\n    \"\"\"è¿è¡Œæ‰€æœ‰Greené˜¶æ®µæµ‹è¯•\"\"\"\n    print(\"ğŸš€ å¼€å§‹TDD Greené˜¶æ®µæµ‹è¯•\")\n    print(\"=\" * 50)\n    \n    tests = [\n        (\"æ”¶é›†å™¨å¯¼å…¥æµ‹è¯•\", test_collector_import),\n        (\"é…ç½®å¯¼å…¥æµ‹è¯•\", test_config_import),\n        (\"CoreæœåŠ¡å¯ç”¨æ€§æµ‹è¯•\", test_core_services_available),\n        (\"åŸºç¡€æ”¶é›†å™¨å®ä¾‹åŒ–æµ‹è¯•\", test_basic_collector_instantiation),\n        (\"Coreé›†æˆåŠŸèƒ½æµ‹è¯•\", test_core_integration_works),\n        (\"é…ç½®è·¯å¾„ç®¡ç†å™¨æµ‹è¯•\", test_config_path_manager),\n    ]\n    \n    passed = 0\n    failed = 0\n    \n    for test_name, test_func in tests:\n        if run_test(test_name, test_func):\n            passed += 1\n        else:\n            failed += 1\n        print()\n    \n    print(\"=\" * 50)\n    print(f\"ğŸ“Š æµ‹è¯•ç»“æœï¼šé€šè¿‡ {passed}ï¼Œå¤±è´¥ {failed}\")\n    \n    if failed == 0:\n        print(\"ğŸ‰ æ‰€æœ‰Greené˜¶æ®µæµ‹è¯•é€šè¿‡ï¼å‡†å¤‡è¿›å…¥Refactoré˜¶æ®µ\")\n        return True\n    else:\n        print(\"âš ï¸  æœ‰æµ‹è¯•å¤±è´¥ï¼Œéœ€è¦ç»§ç»­ä¿®å¤\")\n        return False\n\nif __name__ == \"__main__\":\n    success = main()\n    sys.exit(0 if success else 1)\n"