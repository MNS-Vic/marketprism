# MarketPrism 微服务一键启动脚本

## 🚀 使用方法

每个脚本都是**完全自动化**的一键启动，无需用户交互，直接运行即可：

```bash
# 启动 API 网关服务 (端口: 8080)
./start-api-gateway.sh

# 启动数据采集服务 (端口: 8081)  
./start-data-collector.sh

# 启动数据存储服务 (端口: 8082)
./start-data-storage.sh

# 启动监控服务 (端口: 8083)
./start-monitoring.sh

# 启动调度服务 (端口: 8084)
./start-scheduler.sh

# 启动消息代理服务 (端口: 8085)
./start-message-broker.sh
```

## ✨ 脚本特性

每个脚本都会**自动完成**以下操作：

- ✅ **自动检测项目根目录** - 支持在任何位置运行
- ✅ **自动创建Python虚拟环境** - 隔离依赖，避免冲突
- ✅ **自动安装所需依赖** - 无需手动pip install
- ✅ **自动检测端口冲突** - 智能停止冲突进程
- ✅ **自动设置环境变量** - 配置PYTHONPATH等
- ✅ **自动创建必要目录** - logs、data等目录
- ✅ **实时显示启动信息** - 清晰的状态反馈
- ✅ **完全前台运行** - 按Ctrl+C即可停止

## 📊 服务信息

| 服务 | 端口 | 脚本 | 主要功能 |
|------|------|------|----------|
| API Gateway | 8080 | `start-api-gateway.sh` | 统一网关、路由、认证 |
| Data Collector | 8081 | `start-data-collector.sh` | 数据采集(Binance/OKX/Deribit) |
| Data Storage | 8082 | `start-data-storage.sh` | 热冷存储(Redis/ClickHouse) |
| Monitoring | 8083 | `start-monitoring.sh` | 系统监控、告警 |
| Scheduler | 8084 | `start-scheduler.sh` | 任务调度、自动化 |
| Message Broker | 8085 | `start-message-broker.sh` | 消息队列(NATS) |

## 🌐 访问地址

启动后可以通过以下地址访问：

```
# 健康检查
http://localhost:8080/health  # API Gateway
http://localhost:8081/health  # Data Collector
http://localhost:8082/health  # Data Storage
http://localhost:8083/health  # Monitoring
http://localhost:8084/health  # Scheduler
http://localhost:8085/health  # Message Broker

# 功能页面
http://localhost:8080/_gateway/status     # 网关状态
http://localhost:8081/api/v1/collector/status  # 采集状态
http://localhost:8082/api/v1/storage/status     # 存储状态
http://localhost:8083/api/v1/overview           # 监控概览
http://localhost:8084/api/v1/scheduler/status   # 调度状态
http://localhost:8085/api/v1/broker/status      # 消息状态
```

## 🔧 环境要求

- **Python 3.8+** - 必需
- **操作系统** - macOS/Linux/Windows
- **网络权限** - 用于下载依赖包
- **端口权限** - 8080-8085端口

## 🚀 独立部署

每个脚本都可以**独立运行在不同服务器**上：

```bash
# 服务器 A - 运行网关
./start-api-gateway.sh

# 服务器 B - 运行数据采集
./start-data-collector.sh

# 服务器 C - 运行存储和监控
./start-data-storage.sh &
./start-monitoring.sh

# 服务器 D - 运行调度和消息
./start-scheduler.sh &
./start-message-broker.sh
```

## 📋 使用示例

### 开发环境
```bash
# 只启动需要的服务
./start-monitoring.sh
```

### 测试环境  
```bash
# 启动所有服务进行集成测试
./start-api-gateway.sh &
./start-data-collector.sh &
./start-data-storage.sh &
./start-monitoring.sh &
./start-scheduler.sh &
./start-message-broker.sh &
```

### 生产环境
```bash
# 分服务器部署，每个服务器运行对应脚本
./start-api-gateway.sh     # 网关服务器
./start-data-collector.sh  # 数据服务器  
./start-monitoring.sh      # 监控服务器
```

## ⚠️ 注意事项

1. **首次运行**: 需要下载依赖，可能需要几分钟
2. **端口冲突**: 脚本会自动处理，但确保端口8080-8085可用
3. **依赖服务**: 某些功能需要外部服务(ClickHouse、Redis、NATS)
4. **停止服务**: 按`Ctrl+C`停止，或者`pkill -f "服务名"`

## 🔍 故障排除

### 权限问题
```bash
chmod +x start-*.sh
```

### Python版本问题
```bash
python3 --version  # 需要3.8+
```

### 端口占用问题
```bash
lsof -i :8080      # 查看端口占用
pkill -f "服务名"   # 强制停止服务
```

### 虚拟环境问题
```bash
rm -rf venv        # 删除虚拟环境
./start-xxx.sh     # 重新运行，会自动创建
```

## 📞 技术支持

如遇问题，检查：
1. `logs/` 目录中的日志文件
2. Python版本是否满足要求
3. 网络连接是否正常
4. 端口是否被占用

---

**✨ 真正的一键启动 - 运行脚本，服务即启动！**